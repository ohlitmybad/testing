





<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.535, user-scalable=no"">
	<meta name="robots" content="noindex">
<style>

.metrics-container {
            max-height: 64.2vh; /* Adjust the height based on your content */
            overflow-y: auto; /* Enable vertical scrolling for metrics */
            margin-bottom: 11px; /* Optional: Add margin for spacing */
        }
        @media only screen and (max-width: 767px) {
    /* Apply styles for screens smaller than 768px (typical mobile devices) */
    .metrics-container {
        max-height: 77.5vh; /* Adjusted height for mobile */
	margin-bottom: 18px; /* Optional: Add margin for spacing */

    }
}
 

.spinner {
  display: none;
  position: absolute;
   left: 521px;
   top: 88.926172px;
  transform: translate(-50%, -50%);
  z-index: 9999;
}

.spinner .spinner-icon {
  border: 8px solid transparent;
  border-top-color: #ff5733;
  border-radius: 50%;
  width: 42.5px;
  height: 42.5px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}


.toggle-button {
  position: absolute;
  left: 520.8px;
  top: 19.7px;
  width: 20px; /* Set width */
}

/* Hide the default checkbox */
.toggle-button input[type="checkbox"] {
  opacity: 0;
  width: 0;
  height: 0;
}

/* Style the custom checkbox */
.toggle-button label {
  display: inline-block;
  width: 20px; /* Set width */
  height: 20px; /* Set height */
  background-color: #ccc;
  border-radius: 50%; /* Make it round */
  cursor: pointer;
  position: absolute;
}

/* Style the checked state of the custom checkbox */
.toggle-button input[type="checkbox"]:checked + label {
  background-color: #2196F3;
}

/* Style the slider inside the custom checkbox */
.toggle-button label::before {
  content: "";
  position: absolute;
  width: 12px; /* Set width of the slider */
  height: 12px; /* Set height of the slider */
  background-color: white;
  border-radius: 50%; /* Make it round */
  left: 20%; /* Adjust position */
  top: 20%; /* Adjust position */
  transition: transform 0.3s ease;
}

/* Style the slider when checkbox is checked */
.toggle-button input[type="checkbox"]:checked + label::before {
  transform:scale(0.88)
}


/* Style for the select element */
.select-style {
height: 27.8px;
width: 215px;
cursor: pointer;

}

.select-age {
height: 27.8px;
cursor: pointer;

}

.search-bar {
  top: 0px;
  width: 215px;
  height: 22px;
}

.combo-box {
  position: relative;
  display: inline-block;

}


.custom-dropdown {
  position: absolute;
  top: 19.8%;
  left: 92%;
  width: 6.1%;
  border-top: none;
}

/* Media query for screens smaller than 768px (typical mobile devices) */
@media screen and (max-width: 767px) {
  .custom-dropdown {
    position: absolute;
  top: 19.8%;
  left: 86.6%;
  width: 10.2%;
  border-top: none;
} }




.custom-dropdown select {
  width: 100%;
  border: none;
  font-size: 12px;
  border-radius: 0;
  height: 14.5px;
  cursor: pointer;


}





    .rank-bar {
      background-color: rgb(213, 213, 213);
      border: 1px solid #fff;
      border-radius: 20px;
      cursor: pointer;
      height: 17.1px;
      width: 546px;
      margin-bottom: 5px;
      position: relative;
    }
  
    .rank-bar-fill {
      background-color: rgba(0, 110, 255, 0.835);
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      border-radius: 20px;
    }

    html {
    overflow: scroll;
}
::-webkit-scrollbar {
    width: 0;  /* Remove scrollbar space */
    background: transparent;  /* Optional: just make scrollbar invisible */
}

    body {
          zoom: 119.2%; /* Adjust the percentage as needed */
    font-family: Arial, Helvetica, sans-serif; /* Use Font1 as the primary font */
    font-size: 14.7px;
    color: #000000c4;
    scrollbar-width: none; /* Firefox */
    margin-left: 17.5px;
    margin-top:0.2px;
        background: #fff;
}

h2, h3 {
    font-family: Arial, Helvetica, sans-serif; /* Use Font2 for headings */
    font-size: 22.5px;
    margin-bottom: -8px;
}

h1 {
    font-family: Arial, Helvetica, sans-serif; /* Use Font2 for headings */
    font-size: 16.5px;
    color: #656464ef;
    font-weight: normal !important;
    margin-bottom: 10.5px;
}

.logo-image {
    width: 42px; /* Example width */
   position: absolute;
   left: 500px;
   top: 68px;
}
.toggleSortingButton {
  position: absolute;
  left: 545.8px;
  top: 19.7px;
  width: 20px; /* Set width */
}

/* Hide the default checkbox */
.toggleSortingButton input[type="checkbox"] {
  opacity: 0;
  width: 0;
  height: 0;
}

/* Style the custom checkbox */
.toggleSortingButton label {
  display: inline-block;
  width: 20px; /* Set width */
  height: 20px; /* Set height */
  background-color: #ccc;
  border-radius: 50%; /* Make it round */
  cursor: pointer;
  position: absolute;
}

/* Style the checked state of the custom checkbox */
.toggleSortingButton input[type="checkbox"]:checked + label {
  background-color: #8be31e;
}

/* Style the slider inside the custom checkbox */
.toggleSortingButton label::before {
  content: "";
  position: absolute;
  width: 12px; /* Set width of the slider */
  height: 12px; /* Set height of the slider */
  background-color: white;
  border-radius: 50%; /* Make it round */
  left: 20%; /* Adjust position */
  top: 20%; /* Adjust position */
  transition: transform 0.3s ease;
}

/* Style the slider when checkbox is checked */
.toggleSortingButton input[type="checkbox"]:checked + label::before {
  transform: scale(0.88);
}

/* Existing CSS for toggleSortingButton */
.toggle-button:hover::after {
  content: "Per 90 : Yes / No"; /* Text to display */
  position: absolute;
  top: 26px; /* Adjust as needed */
  left: -30px;
  background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent black background */
  color: #fff; /* Text color */
  padding: 4px 8px; /* Padding around the text */
  border-radius: 5px; /* Rounded corners */
  font-size: 10px; /* Adjust font size as needed */
  white-space: nowrap; /* Prevent line breaks */
}

/* Existing CSS for toggleMetricsButton */
.toggleSortingButton:hover::after {
  content: "Ascending : Yes / No"; /* Text to display */
  position: absolute;
  top: 26px; /* Adjust as needed */
  left: -40px;
  background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent black background */
  color: #fff; /* Text color */
  padding: 4px 8px; /* Padding around the text */
  border-radius: 5px; /* Rounded corners */
  font-size: 10px; /* Adjust font size as needed */
  white-space: nowrap; /* Prevent line breaks */
}

.hover-content {
    position: absolute;
    top: -3.5px; /* Adjust the top value according to your preference */
    left: 95.9%;
    color: #000000;
    transform: translateX(-50%);
    display: none;
    padding: 4px 8px;
    z-index: 1000;
}

  .rank-bar:hover .hover-content,
    .rank-bar.active .hover-content {
      display: block;
    }

	        .spinner, .loading-wheel {
            display: none; /* Hidden by default */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }

        .spinner-icon, .loading-wheel-icon {
            width: 50px;
            height: 50px;
            border: 6px solid #ccc;
            border-top: 6px solid #1d72b8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
  </style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

</head>

<body>


    <div class="spinner" id="spinner">
  <div class="spinner-icon"></div>
</div>
	  <div class="loading-wheel" id="loadingWheel">
        <div class="loading-wheel-icon"></div>
    </div>
  <div class="combo-box">
    <input type="text" id="searchInput" class="search-bar" placeholder="Search for a player...">
    <div class="custom-dropdown">
      <select id="playerSelect" class="search-bar">
        <option value="" disabled selected></option>
        <!-- Options will be dynamically added here -->
      </select>
    </div>
  </div>

  
  
  <select id="sectionSelect" class="select-style">
  </select>
  

  
    <select id="ageSelect" class="select-age">
      <option value="" selected>Age</option>
        <option value="17">U17</option>
        <option value="18">U18</option>
        <option value="19">U19</option>
        <option value="20">U20</option>
        <option value="21">U21</option>
        <option value="22">U22</option>
        <option value="23">U23</option>
        <option value="24">U24</option>
        <option value="25">U25</option>
        <option value="26">U26</option>
        <option value="27">U27</option>
        <option value="28">U28</option>
        <option value="29">U29</option>
        <option value="30">U30</option>
        <option value="35">U35</option>
        <!-- Add more age options as needed -->
    </select>
    <div class="toggle-button">
      <input type="checkbox" id="toggleMetrics" checked> <!-- Add checked attribute here -->
        <label for="toggleMetrics"></label>
    </div>
    <div class="toggleSortingButton">
      <input type="checkbox" id="toggleSortingButton" checked> <!-- Add checked attribute here if needed -->
      <label for="toggleSortingButton"></label>
    </div>
    
<div id="results"></div>

<script>



      // Function to handle spinner display
      function showSpinner() {
        spinner.style.display = 'block';
      }

      // Function to handle spinner hiding
      function hideSpinner() {
        spinner.style.display = 'none';
      }

	   // Function to handle loading wheel display
        function showLoadingWheel() {
            document.getElementById('loadingWheel').style.display = 'block';
        }

        // Function to handle loading wheel hiding
        function hideLoadingWheel() {
            document.getElementById('loadingWheel').style.display = 'none';
        }


      document.addEventListener("DOMContentLoaded", function() {
    var selectElement = document.getElementById("sectionSelect");
    var options = {
        "samePositionAndLeague": "vs League and Position, per 90",
        "samePositionAndLeagueWithMinutes": "vs League and Position",
        "league": "vs League, per 90",
        "leagueWithMinutes": "vs League",
    };

    // Function to add options to the select element
    function addOption(key, value) {
        var option = document.createElement("option");
        option.value = key;
        option.text = value;
        selectElement.add(option);
    }

    // Populate the select element with options based on your criteria
    function populateOptions(usePer90) {
        selectElement.innerHTML = ""; // Clear existing options

        if (usePer90) {
            addOption("samePositionAndLeague", options["samePositionAndLeague"]);
            addOption("league", options["league"]);
        } else {
            addOption("samePositionAndLeagueWithMinutes", options["samePositionAndLeagueWithMinutes"]);
            addOption("leagueWithMinutes", options["leagueWithMinutes"]);
        }
    }

    populateOptions(true); // Initially populate with per 90 options

    // Keep track of the original selected value
    var originalSelectedValue = selectElement.value;

    // Toggle button functionality
    var toggleMetrics = document.getElementById("toggleMetrics");
    toggleMetrics.addEventListener("change", function() {
        // Show spinner
        showSpinner();

        // Get the current selected value
        var selectedValue = selectElement.value;

        // Update the original selected value
        originalSelectedValue = selectedValue;

        // Determine whether the selected metric should be per 90 or not based on the toggle state
        var usePer90 = toggleMetrics.checked;

        // Repopulate options based on toggle state
        populateOptions(usePer90);

        // Update the selected value to its equivalent based on the toggle state
        if (usePer90) {
            selectedValue = selectedValue.replace("WithMinutes", "");
        } else {
            if (!selectedValue.endsWith("WithMinutes")) {
                selectedValue += "WithMinutes";
            }
        }

        // Set the selected value
        selectElement.value = selectedValue;

        // Simulate long computation with setTimeout
        setTimeout(() => {
            // Hide spinner
            hideSpinner();
        }, 1000); // Adjust the timeout value as needed
    });
});



const metricColumnMap = {
    'Successful defensive actions': 'defActions',
    'Defensive duels': 'defDuels',
    'Aerial duels': 'aerialDuels',
    'Tackles': 'slidingTackles',
    'Possession-adjusted tackles': 'pAdjSlidingTackles',
    'Blocked shots': 'shotsBlocked',
    'Interceptions': 'interceptions',
    'Possession-adjusted interceptions': 'pAdjInterceptions',
    'Successful attacking actions': 'successfulAttackingActions',
    'Goals': 'goals',
    'Non-penalty goals': 'nonPenaltyGoals',
    'Expected goals (xG)': 'xG',
    'Headed goals': 'headGoals',
    'Shots': 'shots',
    'Assists': 'assists',
    'Crosses': 'crosses',
    'Crosses to goalkeeper\'s box': 'crossesToGoalieBox',
    'Dribbles': 'dribbles',
    'Offensive duels': 'offensiveDuels',
    'Touches in opponent\'s box': 'touchesInBox',
    'Progressive runs': 'progressiveRuns',
    'Accelerations': 'accelerations',
    'Fouls suffered': 'foulsSuffered',
    'Passes': 'passes',
    'Forward passes': 'forwardPasses',
    'Short passes': 'shortMediumPasses',
    'Long passes': 'longPasses',
    'Average pass length': 'averagePassLength',
    'Expected assists (xA)': 'xA',
    'Shot assists': 'shotAssists',
    'Key passes': 'keyPasses',
    'Passes to final third': 'passesToFinalThird',
    'Passes to penalty area': 'passesToPenaltyArea',
    'Through passes': 'throughPasses',
    'Deep completions': 'deepCompletions',
    'Progressive passes': 'progressivePasses',
    'Shots against': 'shotsAgainst',
    'Clean sheets': 'cleanSheets',
    'Expected goals against': 'xGAgainst',
    'Prevented goals (PSxG-GA)': 'preventedGoals',
    'Line exits': 'exits',
    'Defensive duels won %': 'defensiveDuelsWonPercentage',
    'Aerial duels won %': 'aerialDuelsWonPercentage',
    'Shots on target %': 'shotsOnTargetPercentage',
    'Goal conversion': 'goalConversionPercentage',
    'Cross accuracy': 'accurateCrossesPercentage',
    'Dribble success rate': 'successfulDribblesPercentage',
    'Offensive duels won %': 'offensiveDuelsWonPercentage',
    'Accurate passes %': 'accuratePassesPercentage',
    'Accurate forward passes %': 'accurateForwardPassesPercentage',
    'Accurate short passes %': 'accurateShortMediumPassesPercentage',
    'Accurate long passes %': 'accurateLongPassesPercentage',
    'Accurate passes to final third %': 'accuratePassesToFinalThirdPercentage',
    'Accurate passes to penalty area %': 'accuratePassesToPenaltyAreaPercentage',
    'Through pass accuracy': 'accurateThroughPassesPercentage',
    'Accurate progressive passes %': 'accurateProgressivePassesPercentage',
    'Save percentage': 'saveRatePercentage'
};


  
function getCurrentMetricValue(parsedData, selectedPlayer, metric) {
    const columnName = metricColumnMap[metric]; // Get the corresponding column name

    // List of columns to exclude from multiplication
    const excludedColumns = [
        'pAdjSlidingTackles', 'pAdjInterceptions',
        'averagePassLength', 'xG', 'xA', 'cleanSheets', 'xGAgainst', 'preventedGoals', 'exits',
        'defensiveDuelsWonPercentage', 'aerialDuelsWonPercentage', 'shotsOnTargetPercentage',
        'goalConversionPercentage', 'accurateCrossesPercentage', 'successfulDribblesPercentage',
        'offensiveDuelsWonPercentage', 'accuratePassesPercentage', 'accurateForwardPassesPercentage',
        'accurateShortMediumPassesPercentage', 'accurateLongPassesPercentage',
        'accuratePassesToFinalThirdPercentage', 'accuratePassesToPenaltyAreaPercentage',
        'accurateThroughPassesPercentage', 'accurateProgressivePassesPercentage'
    ];

    const decimalColumns = ['xG', 'xA', 'xGAgainst', 'preventedGoals'];


    // Find player data
    const playerData = parsedData.find(p => 
        p.player === selectedPlayer.player && 
        p.position === selectedPlayer.position && 
        p.league === selectedPlayer.league
    );

    let value = playerData[columnName];

    if (decimalColumns.includes(columnName)) {
        return (value * playerData['minutes'] / 90).toFixed(2);
    }
    else if (excludedColumns.includes(columnName)) {
        return playerData[columnName];
    }
    else {
    return Math.round(value * playerData['minutes'] / 90);}
}


function updateCurrentMetricValue(parsedData, selectedPlayer, metric) {
    const columnName = metricColumnMap[metric]; // Get the corresponding column name

    
    const playerData = parsedData.find(p => p.player === selectedPlayer.player && p.position === selectedPlayer.position && p.league === selectedPlayer.league);



    // Return the metric value without modification
    return playerData[columnName];
}



const allData = [];
let isFirstFileProcessed = false;

	            showLoadingWheel();


const urls = [
  'https://datamb.football/database/OLD/PRO2324/GK/GK.xlsx',
'https://datamb.football/database/OLD/PRO2024/GK/GK.xlsx',
'https://datamb.football/database/OLD/PRO2324/CB/CB.xlsx',
'https://datamb.football/database/OLD/PRO2024/CB/CB.xlsx',
'https://datamb.football/database/OLD/PRO2324/FB/FB.xlsx',
'https://datamb.football/database/OLD/PRO2024/FB/FB.xlsx',
'https://datamb.football/database/OLD/PRO2324/CM/CM.xlsx',
'https://datamb.football/database/OLD/PRO2024/CM/CM.xlsx',
'https://datamb.football/database/OLD/PRO2324/FW/FW.xlsx',
'https://datamb.football/database/OLD/PRO2024/FW/FW.xlsx',
'https://datamb.football/database/OLD/PRO2324/ST/ST.xlsx',
'https://datamb.football/database/OLD/PRO2024/ST/ST.xlsx',
];


const fetchPromises = urls.map(url => fetch(url).then(response => response.arrayBuffer()));

Promise.all(fetchPromises)
    .then(responses => {
        responses.forEach((data, index) => {
            const workbook = XLSX.read(new Uint8Array(data), { type: 'array' });
            const sheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[sheetName];
            let jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

            // Define the label based on the index of the URL
            let label;
                if (index >= 0 && index <= 1) {
                    label = 'Goalkeeper';
                } else if (index >= 2 && index <= 3) {
                    label = 'Centre-back';
                } else if (index >= 4 && index <= 5) {
                    label = 'Full-back';
                } else if (index >= 6 && index <= 7) {
                    label = 'Midfielder';
                } else if (index >= 8 && index <= 9) {
                    label = 'Winger';
                } else if (index >= 10 && index <= 11) {
                    label = 'Striker';
                } else {
                    label = 'Unknown';
                }

            // Iterate through each row in the jsonData
            for (let i = 0; i < jsonData.length; i++) {
                // Skip the header row for all but the first file
                if (index !== 0 && i === 0) continue;

                // Shift the elements to the right in each row
                for (let j = jsonData[i].length - 1; j >= 2; j--) {
                    jsonData[i][j] = jsonData[i][j - 1];
                }

                // Add the label in the 3rd column
                jsonData[i][2] = label;
            }


            // Merge data
            if (!isFirstFileProcessed) {
                allData.push(...jsonData); // Push all rows including header for the first file
                isFirstFileProcessed = true;
            } else {
                allData.push(...jsonData.slice(1)); // Skip header row for subsequent files
            }
        });


        const leagues = {

   
   
"Ukrainian Premier League": [
      "Zorya", "Chornomorets", "Vorskla", "Veres", "Shakhtar Donetsk", "Rukh Lviv", 
      "Polissya", "Oleksandria", "Obolon", "Minaj", "Metalist 1925 Kharkiv", 
      "LNZ Cherkasy", "Kryvbas KR", "Kolos Kovalivka", "Dynamo Kyiv", "Dnipro-1",
   ],

   "Poland Ekstraklasa": [
      "Śląsk Wrocław", "Łódzki KS", "Zagłębie Lubin", "Ruch Chorzów", "Widzew Łódź", 
      "Warta Poznań", "Stal Mielec", "Raków Częstochowa", "Radomiak Radom", 
      "Puszcza Niepołomice", "Pogoń Szczecin", "Piast Gliwice", "Legia Warszawa", 
      "Lech Poznań", "Korona Kielce", "Jagiellonia Białystok", "Górnik Zabrze", 
      "Cracovia Kraków",
   ],
   "Russian Premier League": [
      "Zenit", "Ural", "Spartak Moskva", "Sochi", "Rubin Kazan'", 
      "Rostov", "Orenburg", "Nizhny Novgorod", "Lokomotiv Moskva", 
      "Krylya Sovetov", "Krasnodar", "Fakel", "Dinamo Moskva", 
      "CSKA Moskva", "Baltika", "Akhmat Grozny",
   ],

   "Israel Ligat HaAl": [
      "Maccabi Tel Aviv", "Maccabi Petah Tikva", "Maccabi Netanya", "Maccabi Haifa", 
      "Maccabi Bnei Raina", "Hapoel Tel Aviv", "Hapoel Petah Tikva", "Hapoel Jerusalem", 
      "Hapoel Haifa", "Hapoel Hadera", "Hapoel Be'er Sheva", "Bnei Sakhnin", 
      "Beitar Jerusalem", "Ashdod",
   ],



   "Ecuador Serie A": [
      "Universidad", "Técnico Universitario", "Orense", "Mushuc Runa", 
      "Macará", "Libertad (ECU)", "LDU Quito", "Independiente del Valle", 
      "Imbabura", "Emelec", "El Nacional", "Deportivo Cuenca", 
      "Delfin", "Cumbayá", "Barcelona (ECU)", "Aucas", "Guayaquil City", "Gualaceo",
   ],

   "Chile Primera": [
      "Ñublense", "Unión La Calera", "Unión Española", "Universidad de Chile", 
      "Universidad Católica", "Palestino", "O'Higgins", "Huachipato", 
      "Everton (CHI)", "Deportes Iquique", "Coquimbo Unido", "Copiapó", 
      "Colo Colo", "Cobresal", "Cobreloa", "Audax Italiano", "Curicó Unido", "Magallanes",
   ],

    
      
   "Paraguay Primera": [
      "Tacuary", "Sportivo Trinidense", "Sportivo Luqueño", "Sportivo Ameliano", 
      "Sol de América", "Olimpia", "Nacional Asunción", "Libertad", 
      "Guaraní", "General Caballero JLM", "Cerro Porteño", "2 de Mayo", "Resistencia", "Guaireña",
   ],

   "Greek Super League": [
      "Volos NFC", "Panserraikos", "Panetolikos FC", "Panathinaikos", "PAS Giannina", 
      "PAOK", "Olympiacos Piraeus", "OFI", "Lamia", "Kifissia", 
      "Atromitos", "Asteras Tripolis", "Aris", "AEK Athens",
   ],
  

   "Colombia Primera A": [
      "Águilas Doradas", "Tolima", "Santa Fe", "Medellín", 
      "Patriotas Boyacá", "Once Caldas", "Millonarios", "La Equidad", 
      "Junior", "Jaguares de Córdoba", "Fortaleza (COL)", "Envigado", 
      "Deportivo Pereira", "Deportivo Pasto", "Deportivo Cali", "Boyacá Chicó", 
      "Atlético Nacional", "Atlético Bucaramanga", "América de Cali", "Alianza", "Atlético Huila", "Unión Magdalena",
   ],

   
"Argentina Primera": [
"Argentinos Juniors", "Atlético Tucumán", "Banfield", "Barracas Central", "Belgrano",
"Boca Juniors", "Central Córdoba SdE", "Defensa y Justicia", "Deportivo Riestra", "Estudiantes",
"Gimnasia La Plata", "Godoy Cruz", "Huracán", "Independiente", "Independiente Rivadavia",
"Instituto", "Lanús", "Newell's Old Boys", "Platense", "Racing Club",
"River Plate", "Rosario Central", "San Lorenzo", "Sarmiento", "Talleres Córdoba",
"Tigre", "Unión Santa Fe", "Vélez Sarsfield", "Colón",
],



"Brazil Serie A": [
"Athletico Paranaense", "Atlético GO", "Atlético Mineiro", "Bahia", "Botafogo",
"Corinthians", "Criciúma", "Cruzeiro", "Cuiabá", "Flamengo",
"Fluminense", "Fortaleza", "Grêmio", "Internacional", "Juventude",
"Palmeiras", "Red Bull Bragantino", "São Paulo", "Vasco da Gama", "Vitória", "Santos", "América Mineiro", "Coritiba", "Goiás",
],


"Uruguay Primera": [
"Boston River", "Cerro", "Cerro Largo", "Danubio", "Defensor Sporting",
"Deportivo Maldonado", "Fénix", "Liverpool (URU)", "Miramar Misiones", "Nacional",
"Peñarol", "Progreso", "Racing", "Rampla Juniors", "River Plate (URU)", "Wanderers", "Plaza Colonia", "La Luz", "Torque",
],

"MLS": [
"Los Angeles FC", "Philadelphia Union", "SJ Earthquakes", "Orlando City", "Toronto",
"Minnesota United", "Colorado Rapids", "Chicago Fire", "St. Louis City", "St. Louis City ", "Charlotte FC",
"Dallas", "Vancouver Whitecaps", "Inter Miami", "Austin FC", "DC United",
"Los Angeles Galaxy", "New York RB", "Sporting KC", "Portland Timbers", "Nashville SC",
"Seattle Sounders", "CF Montréal", "Real Salt Lake", "New York City", "Houston Dynamo",
"Atlanta United", "New England", "Cincinnati", "Columbus Crew",
],

"K League 1": [
"Gangwon", "Seoul", "Pohang Steelers", "Suwon", "Gwangju",
"Jeju United", "Ulsan Hyundai", "Daejeon Citizen", "Jeonbuk Motors",
"Incheon United", "Daegu", "Gimcheon Sangmu",
],

  
    
            
          

"J1 League": [
"Albirex Niigata", "Avispa Fukuoka", "Cerezo Osaka", "Consadole Sapporo", "Gamba Osaka",
"Júbilo Iwata", "Kashima Antlers", "Kashiwa Reysol", "Kawasaki Frontale", "Kyoto Sanga",
"Machida Zelvia", "Nagoya Grampus", "Sagan Tosu", "Sanfrecce Hiroshima", "Shonan Bellmare",
"Tokyo", "Tokyo Verdy", "Urawa Reds", "Vissel Kobe", "Yokohama F. Marinos", "Suwon Bluewings", "Yokohama",
],


"Norway Eliteserien": [
"Bodø / Glimt", "Brann", "Fredrikstad", "HamKam", "Haugesund",
"KFUM", "Kristiansund", "Lillestrøm", "Molde", "Odds",
"Rosenborg", "Sandefjord", "Sarpsborg 08", "Strømsgodset", "Tromsø",
"Viking", "Vålerenga", "Aalesund", "Stabæk",
],


"Sweden Allsvenskan": [
"AIK", "Brommapojkarna", "Djurgården", "Elfsborg", "GAIS",
"Halmstad", "Hammarby", "Häcken", "IFK Göteborg", "IFK Norrköping",
"Kalmar", "Malmö FF", "Mjällby", "Sirius", "Värnamo",
"Västerås SK","Degerfors", "Varbergs",

],


"Championship": [
"Leicester City", "Queens Park Rangers", "Plymouth Argyle", "Swansea City", "Cardiff City",
"Sunderland", "Leeds United", "Blackburn Rovers", "Bristol City", "Huddersfield Town",
"Hull City", "Middlesbrough", "Coventry City", "Millwall", "Southampton",
"Reading", "Norwich City", "Stoke City", "Birmingham City", "West Bromwich Albion",
"Preston North End", "Rotherham United", "Watford", "Ipswich Town", "Bristol Rovers", "Sheffield Wednesday",
],
"Süper Lig": [
"Adana Demirspor", "Alanyaspor", "Ankaragücü", "Antalyaspor", "Beşiktaş",
"Fatih Karagümrük", "Fenerbahçe", "Galatasaray", "Gaziantep", "Hatayspor",
"İstanbul Başakşehir", "İstanbulspor", "Kasımpaşa", "Kayserispor", "Konyaspor",
"Pendikspor", "Rizespor", "Samsunspor", "Sivasspor", "Trabzonspor",
],

"Segunda Division": [
"Elche", "Racing Santander", "Alcorcón", "Tenerife", "Huesca",
"Sporting Gijón", "Eldense", "Burgos", "Racing Ferrol", "Espanyol",
"Cartagena", "Villareal B", "Amorebieta", "Albacete", "Leganés",
"Mirandés", "Real Valladolid", "Levante", "FC Andorra", "Real Oviedo", "Eibar", "Villarreal B", "Real Zaragoza",
],

"Scotland Premiership": [
"Celtic", "Rangers", "Motherwell", "Hearts", "Aberdeen", 
"Ross County", "Dundee", "Livingston", "St. Mirren", "Hibernian", 
"St. Johnstone", "Kilmarnock",
],

"Belgium Pro League": [
"Genk", "Eupen", "Antwerp", "Club Brugge", "Standard Liège", 
"Gent", "Anderlecht", "OH Leuven", "Union Saint-Gilloise", "Charleroi", 
"Westerlo", "Mechelen", "RWD Molenbeek", "Kortrijk", "Cercle Brugge", 
"Sint-Truiden",
],

"Swiss Super League": [
"Yverdon Sport", "Young Boys", "St. Gallen", "Lugano", "Zürich", 
"Lausanne Sport", "Basel", "Stade Lausanne-Ouchy", "Grasshopper", 
"Winterthur", "Servette", "Luzern",
],

"Austrian Bundesliga": [
"Sturm Graz", "Rapid Wien", "Salzburg", "Austria Wien", "Austria Klagenfurt", 
"Wolfsberger AC", "Rheindorf Altach", "Austria Lustenau", "WSG Swarovski Tirol", 
"Blau-Weiß Linz", "LASK", "LASK ", "Hartberg",
],

"Saudi Pro League": [
"Al Ahli", "Al Hilal", "Al Nassr", "Al Taawon", "Al Khaleej",
"Al Wehda", "Al Raed", "Al Hazem", "Al Shabab", "Al Fateh",
"Al Ta'ee", "Al Ittihad", "Abha", "Dhamk", "Al Riyadh",
"Al Akhdoud", "Al Ettifaq", "Al Feiha",
],

"LigaMX": [
"Santos Laguna", "Necaxa", "América", "Monterrey", "Cruz Azul",
"Toluca", "Atlas", "Club Tijuana", "Guadalajara", "León",
"Pachuca", "Tigres UANL", "Juárez", "Pumas UNAM", "Mazatlán",
"Querétaro", "Puebla", "Atlético de San Luis",
],


"Denmark Superliga": [
"København", "Brøndby", "Viborg", "AGF", "Randers",
"Midtjylland", "Nordsjælland", "Silkeborg", "OB", "Lyngby",
"Vejle", "Hvidovre",
],

"Czech Fortuna Liga": [
"Slavia Praha", "Mladá Boleslav", "Sparta Praha", "Karviná", "Viktoria Plzeň",
"Slovan Liberec", "Slovácko", "Sigma Olomouc", "Teplice", "Zlín",
"Bohemians 1905", "České Budějovice", "Jablonec", "Baník Ostrava", "Pardubice",
"Hradec Králové",
],

"Serbia SuperLiga": [
"Crvena Zvezda", "Vojvodina", "Bačka Topola", "Partizan", "Radnički Niš",
"Radnički Kragujevac", "Spartak Subotica", "Radnik Surdulica", "Železničar Pancevo", "IMT Novi Beograd",
"Voždovac", "Novi Pazar", "Javor Ivanjica", "Čukarički", "Napredak Kruševac",
"Mladost Novi Sad", "Mladost Lučani",
],

"Croatia HNL": [
"Dinamo Zagreb", "Rijeka", "Istra 1961", "Osijek", "Lokomotiva Zagreb",
"Gorica", "Hajduk Split", "Rudeš", "Slaven Belupo", "Varaždin",
],

"Bundesliga 2": [
"Hamburger SV", "Schalke 04", "Fortuna Düsseldorf", "Osnabrück", "Greuther Fürth",
"Hertha BSC", "St. Pauli", "Hannover 96", "Paderborn", "Holstein Kiel",
"Karlsruher SC", "Nürnberg", "Kaiserslautern", "Hansa Rostock", "Magdeburg",
"Eintracht Braunschweig", "Wehen Wiesbaden", "Elversberg",
],

"Serie B": [
"Spezia", "Bari", "Como", "Cittadella", "Palermo",
"Venezia", "Sampdoria", "Modena", "Parma", "Brescia",
"Reggiana", "Ternana", "Cremonese", "Südtirol", "Ascoli",
"FeralpiSalò", "Pisa", "Cosenza", "Catanzaro", "Lecco",
],

"Ligue 2": [
"Troyes", "Saint-Étienne", "Angers SCO", "Caen", "Guingamp",
"Pau", "Rodez", "Rodez ", "Bordeaux", "Annecy", "Auxerre",
"Quevilly Rouen", "Paris", "Grenoble", "Ajaccio", "Amiens SC",
"Concarneau", "Bastia", "Laval", "Valenciennes", "Dunkerque",
],

   


};
function getTeamLeague(team) {
    for (const [league, teams] of Object.entries(leagues)) {
        if (teams.includes(team)) {
            return league;
        }
    }
    return "Unknown League";
}

const columnsToCopy = [7, 9, 24, 25, 28, 35, 37, 45, 47, 53, 55, 66, 68, 70, 74, 80];

allData.forEach(row => {
    const copiedValues = columnsToCopy.map(col => row[col]);
    row.push(...copiedValues); // Append copied values to the end of the row

    // Assuming your getTeamLeague function and league insertion is correctly handled
    if (row.length >= 3) {
        const team = row[1];
        const league = getTeamLeague(team);
        row.splice(2, 0, league); // Insert league information at index 2
    }
});


const columnsToDelete = [30, 8,10,25,26,29,36,38,46,48,54,56,67,69,71,75,81,16,17,18,30,31,32,42,43,49,50,51,52,58,61,62,63,64,73,76,77,78,82,84,86,88,89,90,91,92,93];

allData.forEach(row => {
    // Sort columnsToDelete in descending order to ensure correct deletion
    columnsToDelete.sort((a, b) => b - a);

    columnsToDelete.forEach(colIndex => {
        if (colIndex < row.length) {
            row.splice(colIndex, 1); // Delete column at colIndex
        }
    });
});



const outputLines = [];

allData.forEach(row => {
    // Join the row back into a single string and replace sequences of commas if needed
    let rowString = row.join(",");
    // Perform any specific replacements or formatting as required
    outputLines.push(rowString);
});

const csvData = outputLines.join("\n");

                      hideLoadingWheel();


function parseCSV(csv) {
    const rows = csv.split('\n').slice(1);
    return rows.map(row => {
      const [
      player, team, league, position, age, minutes, defActions, defDuels,
      aerialDuels, slidingTackles, pAdjSlidingTackles, shotsBlocked,
      interceptions, pAdjInterceptions, successfulAttackingActions, goals,
      nonPenaltyGoals, xG, headGoals, shots, assists, crosses, crossesToGoalieBox,
      dribbles, offensiveDuels, touchesInBox, progressiveRuns, accelerations,
      foulsSuffered, passes, forwardPasses, shortMediumPasses, longPasses,
      averagePassLength, xA, shotAssists, keyPasses, passesToFinalThird,
      passesToPenaltyArea, throughPasses, deepCompletions, progressivePasses,
      shotsAgainst, cleanSheets, xGAgainst, preventedGoals, exits,
      defensiveDuelsWonPercentage, aerialDuelsWonPercentage, shotsOnTargetPercentage,
      goalConversionPercentage, accurateCrossesPercentage, successfulDribblesPercentage,
      offensiveDuelsWonPercentage, accuratePassesPercentage, accurateForwardPassesPercentage,
      accurateShortMediumPassesPercentage, accurateLongPassesPercentage,
      accuratePassesToFinalThirdPercentage, accuratePassesToPenaltyAreaPercentage,
      accurateThroughPassesPercentage, accurateProgressivePassesPercentage,
      saveRatePercentage
      ] = row.split(',');
      return {
        player: player.trim(),
        team: team.trim(),
      league: league.trim(),
      position: position.trim(),
      age: parseInt(age),
      minutes: parseInt(minutes),
      defActions: parseFloat(defActions),
      defDuels: parseFloat(defDuels),
      aerialDuels: parseFloat(aerialDuels),
      slidingTackles: parseFloat(slidingTackles),
      pAdjSlidingTackles: parseFloat(pAdjSlidingTackles),
      shotsBlocked: parseFloat(shotsBlocked),
      interceptions: parseFloat(interceptions),
      pAdjInterceptions: parseFloat(pAdjInterceptions),
      successfulAttackingActions: parseFloat(successfulAttackingActions),
      goals: parseFloat(goals),
      nonPenaltyGoals: parseFloat(nonPenaltyGoals),
      xG: parseFloat(xG),
      headGoals: parseFloat(headGoals),
      shots: parseFloat(shots),
      assists: parseFloat(assists),
      crosses: parseFloat(crosses),
      crossesToGoalieBox: parseFloat(crossesToGoalieBox),
      dribbles: parseFloat(dribbles),
      offensiveDuels: parseFloat(offensiveDuels),
      touchesInBox: parseFloat(touchesInBox),
      progressiveRuns: parseFloat(progressiveRuns),
      accelerations: parseFloat(accelerations),
      foulsSuffered: parseFloat(foulsSuffered),
      passes: parseFloat(passes),
      forwardPasses: parseFloat(forwardPasses),
      shortMediumPasses: parseFloat(shortMediumPasses),
      longPasses: parseFloat(longPasses),
      averagePassLength: parseFloat(averagePassLength),
      xA: parseFloat(xA),
      shotAssists: parseFloat(shotAssists),
      keyPasses: parseFloat(keyPasses),
      passesToFinalThird: parseFloat(passesToFinalThird),
      passesToPenaltyArea: parseFloat(passesToPenaltyArea),
      throughPasses: parseFloat(throughPasses),
      deepCompletions: parseFloat(deepCompletions),
      progressivePasses: parseFloat(progressivePasses),
      shotsAgainst: parseFloat(shotsAgainst),
      cleanSheets: parseFloat(cleanSheets),
      xGAgainst: parseFloat(xGAgainst),
      preventedGoals: parseFloat(preventedGoals),
      exits: parseFloat(exits),
      defensiveDuelsWonPercentage: parseFloat(defensiveDuelsWonPercentage),
      aerialDuelsWonPercentage: parseFloat(aerialDuelsWonPercentage),
      shotsOnTargetPercentage: parseFloat(shotsOnTargetPercentage),
      goalConversionPercentage: parseFloat(goalConversionPercentage),
      accurateCrossesPercentage: parseFloat(accurateCrossesPercentage),
      successfulDribblesPercentage: parseFloat(successfulDribblesPercentage),
      offensiveDuelsWonPercentage: parseFloat(offensiveDuelsWonPercentage),
      accuratePassesPercentage: parseFloat(accuratePassesPercentage),
      accurateForwardPassesPercentage: parseFloat(accurateForwardPassesPercentage),
      accurateShortMediumPassesPercentage: parseFloat(accurateShortMediumPassesPercentage),
      accurateLongPassesPercentage: parseFloat(accurateLongPassesPercentage),
      accuratePassesToFinalThirdPercentage: parseFloat(accuratePassesToFinalThirdPercentage),
      accuratePassesToPenaltyAreaPercentage: parseFloat(accuratePassesToPenaltyAreaPercentage),
      accurateThroughPassesPercentage: parseFloat(accurateThroughPassesPercentage),
      accurateProgressivePassesPercentage: parseFloat(accurateProgressivePassesPercentage),
      saveRatePercentage: parseFloat(saveRatePercentage)
      };
    });
  }

  
  
  function calculateRankForMetric(data, metric, filterFn, transformFn) {
  const filteredData = filterFn ? data.filter(filterFn) : data;
  
  // Apply transformation function if provided
  const transformedData = transformFn ? filteredData.map(transformFn) : filteredData;

  // Use a Map to store unique players based on their name and team
  const uniquePlayers = new Map();

  // Populate uniquePlayers map
  transformedData.forEach(player => {
    const key = `${player.player}-${player.team}`;
    if (!uniquePlayers.has(key)) {
      uniquePlayers.set(key, player);
    }
  });

  // Sort unique players by the specified metric
  const sortedData = Array.from(uniquePlayers.values()).sort((a, b) => b[metric] - a[metric]);

  let rank = 1;
  let prevValue = null;

  // Perform computation and store the results in an array
  const playerRanks = sortedData.map(player => {
    const current0Value = player[metric];
    
    // Check if current0Value is 0
    if (current0Value === 0) {
      // If current0Value is 0, set rank to 0
      rank = 10000;
    } else if (current0Value !== prevValue) {
      // Otherwise, calculate rank normally
      prevValue = current0Value;
      rank = sortedData.findIndex(p => p[metric] === current0Value) + 1;
    }
    return {
      player: player.player,
      team: player.team,
      rank: rank
    };
  });

  // Replace "10000th" with "N/A" in the player ranks
  playerRanks.forEach(player => {
    if (player.rank === 10000) {
      player.rank = "N/A";
    }
  });

  return playerRanks;
}



function getRankSuffix(rank) {
    // Check if rank is "N/A"
    if (rank === "N/A") {
        return ''; // Return empty string for "N/A"
    }

    const lastDigit = rank % 10;
    const lastTwoDigits = rank % 100;
    if (lastTwoDigits >= 11 && lastTwoDigits <= 13) {
        return 'th';
    }
    switch (lastDigit) {
        case 1: return 'st';
        case 2: return 'nd';
        case 3: return 'rd';
        default: return 'th';
    }
}


// Define a global variable to track sorting preference
let sortEnabled = true;



function displaySelectedPlayer() {
  document.getElementById('spinner').style.display = 'block';
  const playerSelect = document.getElementById('playerSelect');
  const selectedIndex = playerSelect.selectedIndex;
  const selectedPlayerName = playerSelect.options[selectedIndex].value;
  const selectedPlayerPosition = playerSelect.options[selectedIndex].textContent.split(', ')[1]; // Extract position
  const selectedPlayerTeam = playerSelect.options[selectedIndex].textContent.split(', ')[2]; // Extract position
 const selectedPlayer = {
    player: selectedPlayerName,
    team: selectedPlayerTeam,
    position: selectedPlayerPosition // Include position in the selectedPlayer object
  };
  displayPlayerRankings(selectedPlayer);
  document.getElementById('spinner').style.display = 'none';
    
}


function displayPlayerRankings(player) {
    const selectedPlayer = parsedData.find(p => p.player === player.player && p.position === player.position &&
        p.team === player.team);
    const ageSelect = document.getElementById('ageSelect');
    const selectedAge = parseInt(ageSelect.value);
    const filteredData = selectedAge ? parsedData.filter(p => p.age <= selectedAge) : parsedData;
    const toggleMetrics = document.getElementById('toggleMetrics').checked; // Check if toggle is toggled
    const getMetricValueFunction = toggleMetrics ? updateCurrentMetricValue : getCurrentMetricValue;

    const samePositionAndLeagueActions = calculateRankForMetric(filteredData, 'defActions', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);
    const samePositionAndLeagueDuels = calculateRankForMetric(filteredData, 'defDuels', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);
    const samePositionAndLeagueActionsWithMinutes = calculateRankForMetric(filteredData, 'defActions', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, defActions: Math.round(p.defActions * p.minutes / 90)}));
    const samePositionAndLeagueDuelsWithMinutes = calculateRankForMetric(filteredData, 'defDuels', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, defDuels: Math.round(p.defDuels * p.minutes / 90)}));
   const leagueRankActions = calculateRankForMetric(filteredData, 'defActions', p => p.league === selectedPlayer.league);
    const leagueRankDuels = calculateRankForMetric(filteredData, 'defDuels', p => p.league === selectedPlayer.league);
    const leagueRankActionsWithMinutes = calculateRankForMetric(filteredData, 'defActions', p => p.league === selectedPlayer.league, p => ({...p, defActions: Math.round(p.defActions * p.minutes / 90)}));
    const leagueRankDuelsWithMinutes = calculateRankForMetric(filteredData, 'defDuels', p => p.league === selectedPlayer.league, p => ({...p, defDuels: Math.round(p.defDuels * p.minutes / 90)}));
 
    const leagueRankAerialDuels = calculateRankForMetric(filteredData, 'aerialDuels', p => p.league === selectedPlayer.league);


const leagueRankAerialDuelsWithMinutes = calculateRankForMetric(filteredData, 'aerialDuels', p => p.league === selectedPlayer.league, p => ({...p, aerialDuels: Math.round(p.aerialDuels * p.minutes / 90)}));

const samePositionAndLeagueAerialDuels = calculateRankForMetric(filteredData, 'aerialDuels', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAerialDuelsWithMinutes = calculateRankForMetric(filteredData, 'aerialDuels', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, aerialDuels: Math.round(p.aerialDuels * p.minutes / 90)}));

// Metric: slidingTackles

const leagueRankSlidingTackles = calculateRankForMetric(filteredData, 'slidingTackles', p => p.league === selectedPlayer.league);


const leagueRankSlidingTacklesWithMinutes = calculateRankForMetric(filteredData, 'slidingTackles', p => p.league === selectedPlayer.league, p => ({...p, slidingTackles: Math.round(p.slidingTackles * p.minutes / 90)}));


const samePositionAndLeagueSlidingTackles = calculateRankForMetric(filteredData, 'slidingTackles', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueSlidingTacklesWithMinutes = calculateRankForMetric(filteredData, 'slidingTackles', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, slidingTackles: Math.round(p.slidingTackles * p.minutes / 90)}));

// Metric: pAdjSlidingTackles

const leagueRankPAdjSlidingTackles = calculateRankForMetric(filteredData, 'pAdjSlidingTackles', p => p.league === selectedPlayer.league);


const leagueRankPAdjSlidingTacklesWithMinutes = calculateRankForMetric(filteredData, 'pAdjSlidingTackles', p => p.league === selectedPlayer.league);


const samePositionAndLeaguePAdjSlidingTackles = calculateRankForMetric(filteredData, 'pAdjSlidingTackles', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeaguePAdjSlidingTacklesWithMinutes = calculateRankForMetric(filteredData, 'pAdjSlidingTackles', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

// Metric: shotsBlocked

const leagueRankShotsBlocked = calculateRankForMetric(filteredData, 'shotsBlocked', p => p.league === selectedPlayer.league);


const leagueRankShotsBlockedWithMinutes = calculateRankForMetric(filteredData, 'shotsBlocked', p => p.league === selectedPlayer.league, p => ({...p, shotsBlocked: Math.round(p.shotsBlocked * p.minutes / 90)}));


const samePositionAndLeagueShotsBlocked = calculateRankForMetric(filteredData, 'shotsBlocked', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueShotsBlockedWithMinutes = calculateRankForMetric(filteredData, 'shotsBlocked', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, shotsBlocked: Math.round(p.shotsBlocked * p.minutes / 90)}));

// Metric: interceptions

const leagueRankInterceptions = calculateRankForMetric(filteredData, 'interceptions', p => p.league === selectedPlayer.league);


const leagueRankInterceptionsWithMinutes = calculateRankForMetric(filteredData, 'interceptions', p => p.league === selectedPlayer.league, p => ({...p, interceptions: Math.round(p.interceptions * p.minutes / 90)}));


const samePositionAndLeagueInterceptions = calculateRankForMetric(filteredData, 'interceptions', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueInterceptionsWithMinutes = calculateRankForMetric(filteredData, 'interceptions', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, interceptions: Math.round(p.interceptions * p.minutes / 90)}));

// Metric: pAdjInterceptions

const leagueRankPAdjInterceptions = calculateRankForMetric(filteredData, 'pAdjInterceptions', p => p.league === selectedPlayer.league);


const leagueRankPAdjInterceptionsWithMinutes = calculateRankForMetric(filteredData, 'pAdjInterceptions', p => p.league === selectedPlayer.league);

const samePositionAndLeaguePAdjInterceptions = calculateRankForMetric(filteredData, 'pAdjInterceptions', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeaguePAdjInterceptionsWithMinutes = calculateRankForMetric(filteredData, 'pAdjInterceptions', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);


// Metric: successfulAttackingActions

const leagueRankSuccessfulAttackingActions = calculateRankForMetric(filteredData, 'successfulAttackingActions', p => p.league === selectedPlayer.league);


const leagueRankSuccessfulAttackingActionsWithMinutes = calculateRankForMetric(filteredData, 'successfulAttackingActions', p => p.league === selectedPlayer.league, p => ({...p, successfulAttackingActions: Math.round(p.successfulAttackingActions * p.minutes / 90)}));


const samePositionAndLeagueSuccessfulAttackingActions = calculateRankForMetric(filteredData, 'successfulAttackingActions', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueSuccessfulAttackingActionsWithMinutes = calculateRankForMetric(filteredData, 'successfulAttackingActions', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, successfulAttackingActions: Math.round(p.successfulAttackingActions * p.minutes / 90)}));

// Metric: goals

const leagueRankGoals = calculateRankForMetric(filteredData, 'goals', p => p.league === selectedPlayer.league);


const leagueRankGoalsWithMinutes = calculateRankForMetric(filteredData, 'goals', p => p.league === selectedPlayer.league, p => ({...p, goals: Math.round(p.goals * p.minutes / 90)}));


const samePositionAndLeagueGoals = calculateRankForMetric(filteredData, 'goals', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueGoalsWithMinutes = calculateRankForMetric(filteredData, 'goals', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, goals: Math.round(p.goals * p.minutes / 90)}));

// Metric: nonPenaltyGoals

const leagueRankNonPenaltyGoals = calculateRankForMetric(filteredData, 'nonPenaltyGoals', p => p.league === selectedPlayer.league);


const leagueRankNonPenaltyGoalsWithMinutes = calculateRankForMetric(filteredData, 'nonPenaltyGoals', p => p.league === selectedPlayer.league, p => ({...p, nonPenaltyGoals: Math.round(p.nonPenaltyGoals * p.minutes / 90)}));

const samePositionAndLeagueNonPenaltyGoals = calculateRankForMetric(filteredData, 'nonPenaltyGoals', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueNonPenaltyGoalsWithMinutes = calculateRankForMetric(filteredData, 'nonPenaltyGoals', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, nonPenaltyGoals: Math.round(p.nonPenaltyGoals * p.minutes / 90)}));

// Metric: xG

const leagueRankXG = calculateRankForMetric(filteredData, 'xG', p => p.league === selectedPlayer.league);


const leagueRankXGWithMinutes = calculateRankForMetric(filteredData, 'xG', p => p.league === selectedPlayer.league, p => ({...p, xG: p.xG * p.minutes}));


const samePositionAndLeagueXG = calculateRankForMetric(filteredData, 'xG', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueXGWithMinutes = calculateRankForMetric(filteredData, 'xG', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, xG: p.xG * p.minutes}));

// Metric: headGoals

const leagueRankHeadGoals = calculateRankForMetric(filteredData, 'headGoals', p => p.league === selectedPlayer.league);


const leagueRankHeadGoalsWithMinutes = calculateRankForMetric(filteredData, 'headGoals', p => p.league === selectedPlayer.league, p => ({...p, headGoals: Math.round(p.headGoals * p.minutes / 90)}));


const samePositionAndLeagueHeadGoals = calculateRankForMetric(filteredData, 'headGoals', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueHeadGoalsWithMinutes = calculateRankForMetric(filteredData, 'headGoals', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, headGoals: Math.round(p.headGoals * p.minutes / 90)}));

// Metric: shots

const leagueRankShots = calculateRankForMetric(filteredData, 'shots', p => p.league === selectedPlayer.league);


const leagueRankShotsWithMinutes = calculateRankForMetric(filteredData, 'shots', p => p.league === selectedPlayer.league, p => ({...p, shots: Math.round(p.shots * p.minutes / 90)}));


const samePositionAndLeagueShots = calculateRankForMetric(filteredData, 'shots', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueShotsWithMinutes = calculateRankForMetric(filteredData, 'shots', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, shots: Math.round(p.shots * p.minutes / 90)}));

// Metric: assists

const leagueRankAssists = calculateRankForMetric(filteredData, 'assists', p => p.league === selectedPlayer.league);


const leagueRankAssistsWithMinutes = calculateRankForMetric(filteredData, 'assists', p => p.league === selectedPlayer.league, p => ({...p, assists: Math.round(p.assists * p.minutes / 90)}));


const samePositionAndLeagueAssists = calculateRankForMetric(filteredData, 'assists', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAssistsWithMinutes = calculateRankForMetric(filteredData, 'assists', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, assists: Math.round(p.assists * p.minutes / 90)}));

// Metric: crosses

const leagueRankCrosses = calculateRankForMetric(filteredData, 'crosses', p => p.league === selectedPlayer.league);


const leagueRankCrossesWithMinutes = calculateRankForMetric(filteredData, 'crosses', p => p.league === selectedPlayer.league, p => ({...p, crosses: Math.round(p.crosses * p.minutes / 90)}));


const samePositionAndLeagueCrosses = calculateRankForMetric(filteredData, 'crosses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueCrossesWithMinutes = calculateRankForMetric(filteredData, 'crosses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, crosses: Math.round(p.crosses * p.minutes / 90)}));

// Metric: crossesToGoalieBox

const leagueRankCrossesToGoalieBox = calculateRankForMetric(filteredData, 'crossesToGoalieBox', p => p.league === selectedPlayer.league);


const leagueRankCrossesToGoalieBoxWithMinutes = calculateRankForMetric(filteredData, 'crossesToGoalieBox', p => p.league === selectedPlayer.league, p => ({...p, crossesToGoalieBox: Math.round(p.crossesToGoalieBox * p.minutes / 90)}));

const samePositionAndLeagueCrossesToGoalieBox = calculateRankForMetric(filteredData, 'crossesToGoalieBox', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueCrossesToGoalieBoxWithMinutes = calculateRankForMetric(filteredData, 'crossesToGoalieBox', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, crossesToGoalieBox: Math.round(p.crossesToGoalieBox * p.minutes / 90)}));

// Metric: dribbles

const leagueRankDribbles = calculateRankForMetric(filteredData, 'dribbles', p => p.league === selectedPlayer.league);


const leagueRankDribblesWithMinutes = calculateRankForMetric(filteredData, 'dribbles', p => p.league === selectedPlayer.league, p => ({...p, dribbles: Math.round(p.dribbles * p.minutes / 90)}));


const samePositionAndLeagueDribbles = calculateRankForMetric(filteredData, 'dribbles', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueDribblesWithMinutes = calculateRankForMetric(filteredData, 'dribbles', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, dribbles: Math.round(p.dribbles * p.minutes / 90)}));

// Metric: offensiveDuels

const leagueRankOffensiveDuels = calculateRankForMetric(filteredData, 'offensiveDuels', p => p.league === selectedPlayer.league);


const leagueRankOffensiveDuelsWithMinutes = calculateRankForMetric(filteredData, 'offensiveDuels', p => p.league === selectedPlayer.league, p => ({...p, offensiveDuels: Math.round(p.offensiveDuels * p.minutes / 90)}));


const samePositionAndLeagueOffensiveDuels = calculateRankForMetric(filteredData, 'offensiveDuels', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueOffensiveDuelsWithMinutes = calculateRankForMetric(filteredData, 'offensiveDuels', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, offensiveDuels: Math.round(p.offensiveDuels * p.minutes / 90)}));

// Metric: touchesInBox

const leagueRankTouchesInBox = calculateRankForMetric(filteredData, 'touchesInBox', p => p.league === selectedPlayer.league);


const leagueRankTouchesInBoxWithMinutes = calculateRankForMetric(filteredData, 'touchesInBox', p => p.league === selectedPlayer.league, p => ({...p, touchesInBox: Math.round(p.touchesInBox * p.minutes / 90)}));


const samePositionAndLeagueTouchesInBox = calculateRankForMetric(filteredData, 'touchesInBox', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueTouchesInBoxWithMinutes = calculateRankForMetric(filteredData, 'touchesInBox', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, touchesInBox: Math.round(p.touchesInBox * p.minutes / 90)}));

// Metric: progressiveRuns

const leagueRankProgressiveRuns = calculateRankForMetric(filteredData, 'progressiveRuns', p => p.league === selectedPlayer.league);


const leagueRankProgressiveRunsWithMinutes = calculateRankForMetric(filteredData, 'progressiveRuns', p => p.league === selectedPlayer.league, p => ({...p, progressiveRuns: Math.round(p.progressiveRuns * p.minutes / 90)}));


const samePositionAndLeagueProgressiveRuns = calculateRankForMetric(filteredData, 'progressiveRuns', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueProgressiveRunsWithMinutes = calculateRankForMetric(filteredData, 'progressiveRuns', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, progressiveRuns: Math.round(p.progressiveRuns * p.minutes / 90)}));

// Metric: accelerations

const leagueRankAccelerations = calculateRankForMetric(filteredData, 'accelerations', p => p.league === selectedPlayer.league);


const leagueRankAccelerationsWithMinutes = calculateRankForMetric(filteredData, 'accelerations', p => p.league === selectedPlayer.league, p => ({...p, accelerations: Math.round(p.accelerations * p.minutes / 90)}));


const samePositionAndLeagueAccelerations = calculateRankForMetric(filteredData, 'accelerations', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAccelerationsWithMinutes = calculateRankForMetric(filteredData, 'accelerations', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, accelerations: Math.round(p.accelerations * p.minutes / 90)}));

// Metric: foulsSuffered

const leagueRankFoulsSuffered = calculateRankForMetric(filteredData, 'foulsSuffered', p => p.league === selectedPlayer.league);


const leagueRankFoulsSufferedWithMinutes = calculateRankForMetric(filteredData, 'foulsSuffered', p => p.league === selectedPlayer.league, p => ({...p, foulsSuffered: Math.round(p.foulsSuffered * p.minutes / 90)}));


const samePositionAndLeagueFoulsSuffered = calculateRankForMetric(filteredData, 'foulsSuffered', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueFoulsSufferedWithMinutes = calculateRankForMetric(filteredData, 'foulsSuffered', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, foulsSuffered: Math.round(p.foulsSuffered * p.minutes / 90)}));

// Metric: passes

const leagueRankPasses = calculateRankForMetric(filteredData, 'passes', p => p.league === selectedPlayer.league);


const leagueRankPassesWithMinutes = calculateRankForMetric(filteredData, 'passes', p => p.league === selectedPlayer.league, p => ({...p, passes: Math.round(p.passes * p.minutes / 90)}));

const samePositionAndLeaguePasses = calculateRankForMetric(filteredData, 'passes', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeaguePassesWithMinutes = calculateRankForMetric(filteredData, 'passes', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, passes: Math.round(p.passes * p.minutes / 90)}));

// Metric: forwardPasses

const leagueRankForwardPasses = calculateRankForMetric(filteredData, 'forwardPasses', p => p.league === selectedPlayer.league);


const leagueRankForwardPassesWithMinutes = calculateRankForMetric(filteredData, 'forwardPasses', p => p.league === selectedPlayer.league, p => ({...p, forwardPasses: Math.round(p.forwardPasses * p.minutes / 90)}));


const samePositionAndLeagueForwardPasses = calculateRankForMetric(filteredData, 'forwardPasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueForwardPassesWithMinutes = calculateRankForMetric(filteredData, 'forwardPasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, forwardPasses: Math.round(p.forwardPasses * p.minutes / 90)}));

// Metric: shortMediumPasses

const leagueRankShortMediumPasses = calculateRankForMetric(filteredData, 'shortMediumPasses', p => p.league === selectedPlayer.league);


const leagueRankShortMediumPassesWithMinutes = calculateRankForMetric(filteredData, 'shortMediumPasses', p => p.league === selectedPlayer.league, p => ({...p, shortMediumPasses: Math.round(p.shortMediumPasses * p.minutes / 90)}));


const samePositionAndLeagueShortMediumPasses = calculateRankForMetric(filteredData, 'shortMediumPasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueShortMediumPassesWithMinutes = calculateRankForMetric(filteredData, 'shortMediumPasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, shortMediumPasses: Math.round(p.shortMediumPasses * p.minutes / 90)}));

// Metric: longPasses

const leagueRankLongPasses = calculateRankForMetric(filteredData, 'longPasses', p => p.league === selectedPlayer.league);


const leagueRankLongPassesWithMinutes = calculateRankForMetric(filteredData, 'longPasses', p => p.league === selectedPlayer.league, p => ({...p, longPasses: Math.round(p.longPasses * p.minutes / 90)}));


const samePositionAndLeagueLongPasses = calculateRankForMetric(filteredData, 'longPasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueLongPassesWithMinutes = calculateRankForMetric(filteredData, 'longPasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, longPasses: Math.round(p.longPasses * p.minutes / 90)}));

// Metric: averagePassLength

const leagueRankAveragePassLength = calculateRankForMetric(filteredData, 'averagePassLength', p => p.league === selectedPlayer.league);


const leagueRankAveragePassLengthWithMinutes = calculateRankForMetric(filteredData, 'averagePassLength', p => p.league === selectedPlayer.league);


const samePositionAndLeagueAveragePassLength = calculateRankForMetric(filteredData, 'averagePassLength', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAveragePassLengthWithMinutes = calculateRankForMetric(filteredData, 'averagePassLength', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

// Metric: xA (Expected Assists)

const leagueRankXA = calculateRankForMetric(filteredData, 'xA', p => p.league === selectedPlayer.league);


const leagueRankXAWithMinutes = calculateRankForMetric(filteredData, 'xA', p => p.league === selectedPlayer.league, p => ({...p, xA: p.xA * p.minutes}));


const samePositionAndLeagueXA = calculateRankForMetric(filteredData, 'xA', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueXAWithMinutes = calculateRankForMetric(filteredData, 'xA', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, xA: p.xA * p.minutes}));

// Metric: shotAssists

const leagueRankShotAssists = calculateRankForMetric(filteredData, 'shotAssists', p => p.league === selectedPlayer.league);


const leagueRankShotAssistsWithMinutes = calculateRankForMetric(filteredData, 'shotAssists', p => p.league === selectedPlayer.league, p => ({...p, shotAssists: Math.round(p.shotAssists * p.minutes / 90)}));


const samePositionAndLeagueShotAssists = calculateRankForMetric(filteredData, 'shotAssists', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueShotAssistsWithMinutes = calculateRankForMetric(filteredData, 'shotAssists', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, shotAssists: Math.round(p.shotAssists * p.minutes / 90)}));

// Metric: keyPasses

const leagueRankKeyPasses = calculateRankForMetric(filteredData, 'keyPasses', p => p.league === selectedPlayer.league);


const leagueRankKeyPassesWithMinutes = calculateRankForMetric(filteredData, 'keyPasses', p => p.league === selectedPlayer.league, p => ({...p, keyPasses: Math.round(p.keyPasses * p.minutes / 90)}));


const samePositionAndLeagueKeyPasses = calculateRankForMetric(filteredData, 'keyPasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueKeyPassesWithMinutes = calculateRankForMetric(filteredData, 'keyPasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, keyPasses: Math.round(p.keyPasses * p.minutes / 90)}));

// Metric: passesToFinalThird

const leagueRankPassesToFinalThird = calculateRankForMetric(filteredData, 'passesToFinalThird', p => p.league === selectedPlayer.league);


const leagueRankPassesToFinalThirdWithMinutes = calculateRankForMetric(filteredData, 'passesToFinalThird', p => p.league === selectedPlayer.league, p => ({...p, passesToFinalThird: Math.round(p.passesToFinalThird * p.minutes / 90)}));


const samePositionAndLeaguePassesToFinalThird = calculateRankForMetric(filteredData, 'passesToFinalThird', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeaguePassesToFinalThirdWithMinutes = calculateRankForMetric(filteredData, 'passesToFinalThird', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, passesToFinalThird: Math.round(p.passesToFinalThird * p.minutes / 90)}));

// Metric: passesToPenaltyArea

const leagueRankPassesToPenaltyArea = calculateRankForMetric(filteredData, 'passesToPenaltyArea', p => p.league === selectedPlayer.league);


const leagueRankPassesToPenaltyAreaWithMinutes = calculateRankForMetric(filteredData, 'passesToPenaltyArea', p => p.league === selectedPlayer.league, p => ({...p, passesToPenaltyArea: Math.round(p.passesToPenaltyArea * p.minutes / 90)}));


const samePositionAndLeaguePassesToPenaltyArea = calculateRankForMetric(filteredData, 'passesToPenaltyArea', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeaguePassesToPenaltyAreaWithMinutes = calculateRankForMetric(filteredData, 'passesToPenaltyArea', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, passesToPenaltyArea: Math.round(p.passesToPenaltyArea * p.minutes / 90)}));

// Metric: throughPasses

const leagueRankThroughPasses = calculateRankForMetric(filteredData, 'throughPasses', p => p.league === selectedPlayer.league);


const leagueRankThroughPassesWithMinutes = calculateRankForMetric(filteredData, 'throughPasses', p => p.league === selectedPlayer.league, p => ({...p, throughPasses: Math.round(p.throughPasses * p.minutes / 90)}));

const samePositionAndLeagueThroughPasses = calculateRankForMetric(filteredData, 'throughPasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueThroughPassesWithMinutes = calculateRankForMetric(filteredData, 'throughPasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, throughPasses: Math.round(p.throughPasses * p.minutes / 90)}));

// Metric: deepCompletions

const leagueRankDeepCompletions = calculateRankForMetric(filteredData, 'deepCompletions', p => p.league === selectedPlayer.league);


const leagueRankDeepCompletionsWithMinutes = calculateRankForMetric(filteredData, 'deepCompletions', p => p.league === selectedPlayer.league, p => ({...p, deepCompletions: Math.round(p.deepCompletions * p.minutes / 90)}));

const samePositionAndLeagueDeepCompletions = calculateRankForMetric(filteredData, 'deepCompletions', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueDeepCompletionsWithMinutes = calculateRankForMetric(filteredData, 'deepCompletions', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, deepCompletions: Math.round(p.deepCompletions * p.minutes / 90)}));

// Metric: progressivePasses

const leagueRankProgressivePasses = calculateRankForMetric(filteredData, 'progressivePasses', p => p.league === selectedPlayer.league);


const leagueRankProgressivePassesWithMinutes = calculateRankForMetric(filteredData, 'progressivePasses', p => p.league === selectedPlayer.league, p => ({...p, progressivePasses: Math.round(p.progressivePasses * p.minutes / 90)}));


const samePositionAndLeagueProgressivePasses = calculateRankForMetric(filteredData, 'progressivePasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueProgressivePassesWithMinutes = calculateRankForMetric(filteredData, 'progressivePasses', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, progressivePasses: Math.round(p.progressivePasses * p.minutes / 90)}));

// Metric: shotsAgainst

const leagueRankShotsAgainst = calculateRankForMetric(filteredData, 'shotsAgainst', p => p.league === selectedPlayer.league);


const leagueRankShotsAgainstWithMinutes = calculateRankForMetric(filteredData, 'shotsAgainst', p => p.league === selectedPlayer.league, p => ({...p, shotsAgainst: Math.round(p.shotsAgainst * p.minutes / 90)}));


const samePositionAndLeagueShotsAgainst = calculateRankForMetric(filteredData, 'shotsAgainst', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueShotsAgainstWithMinutes = calculateRankForMetric(filteredData, 'shotsAgainst', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, shotsAgainst: Math.round(p.shotsAgainst * p.minutes / 90)}));

// Metric: cleanSheets

const leagueRankCleanSheets = calculateRankForMetric(filteredData, 'cleanSheets', p => p.league === selectedPlayer.league);


const leagueRankCleanSheetsWithMinutes = calculateRankForMetric(filteredData, 'cleanSheets', p => p.league === selectedPlayer.league);


const samePositionAndLeagueCleanSheets = calculateRankForMetric(filteredData, 'cleanSheets', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueCleanSheetsWithMinutes = calculateRankForMetric(filteredData, 'cleanSheets', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

// Metric: xGAgainst

const leagueRankXGAgainst = calculateRankForMetric(filteredData, 'xGAgainst', p => p.league === selectedPlayer.league);


const leagueRankXGAgainstWithMinutes = calculateRankForMetric(filteredData, 'xGAgainst', p => p.league === selectedPlayer.league, p => ({...p, xGAgainst: p.xGAgainst * p.minutes}));

const samePositionAndLeagueXGAgainst = calculateRankForMetric(filteredData, 'xGAgainst', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueXGAgainstWithMinutes = calculateRankForMetric(filteredData, 'xGAgainst', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, xGAgainst: p.xGAgainst * p.minutes}));

// Metric: preventedGoals

const leagueRankPreventedGoals = calculateRankForMetric(filteredData, 'preventedGoals', p => p.league === selectedPlayer.league);


const leagueRankPreventedGoalsWithMinutes = calculateRankForMetric(filteredData, 'preventedGoals', p => p.league === selectedPlayer.league, p => ({...p, preventedGoals: p.preventedGoals * p.minutes}));

const samePositionAndLeaguePreventedGoals = calculateRankForMetric(filteredData, 'preventedGoals', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeaguePreventedGoalsWithMinutes = calculateRankForMetric(filteredData, 'preventedGoals', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, preventedGoals: p.preventedGoals * p.minutes}));

// Metric: exits

const leagueRankExits = calculateRankForMetric(filteredData, 'exits', p => p.league === selectedPlayer.league);


const leagueRankExitsWithMinutes = calculateRankForMetric(filteredData, 'exits', p => p.league === selectedPlayer.league, p => ({...p, exits: Math.round(p.exits * p.minutes / 90)}));


const samePositionAndLeagueExits = calculateRankForMetric(filteredData, 'exits', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueExitsWithMinutes = calculateRankForMetric(filteredData, 'exits', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p, exits: Math.round(p.exits * p.minutes / 90)}));

// Metric: defensiveDuelsWonPercentage

const leagueRankDefensiveDuelsWonPercentage = calculateRankForMetric(filteredData, 'defensiveDuelsWonPercentage', p => p.league === selectedPlayer.league);


const leagueRankDefensiveDuelsWonPercentageWithMinutes = calculateRankForMetric(filteredData, 'defensiveDuelsWonPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueDefensiveDuelsWonPercentage = calculateRankForMetric(filteredData, 'defensiveDuelsWonPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueDefensiveDuelsWonPercentageWithMinutes = calculateRankForMetric(filteredData, 'defensiveDuelsWonPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: aerialDuelsWonPercentage

const leagueRankAerialDuelsWonPercentage = calculateRankForMetric(filteredData, 'aerialDuelsWonPercentage', p => p.league === selectedPlayer.league);


const leagueRankAerialDuelsWonPercentageWithMinutes = calculateRankForMetric(filteredData, 'aerialDuelsWonPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueAerialDuelsWonPercentage = calculateRankForMetric(filteredData, 'aerialDuelsWonPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAerialDuelsWonPercentageWithMinutes = calculateRankForMetric(filteredData, 'aerialDuelsWonPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: shotsOnTargetPercentage

const leagueRankShotsOnTargetPercentage = calculateRankForMetric(filteredData, 'shotsOnTargetPercentage', p => p.league === selectedPlayer.league);


const leagueRankShotsOnTargetPercentageWithMinutes = calculateRankForMetric(filteredData, 'shotsOnTargetPercentage', p => p.league === selectedPlayer.league, p => ({...p}));


const samePositionAndLeagueShotsOnTargetPercentage = calculateRankForMetric(filteredData, 'shotsOnTargetPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueShotsOnTargetPercentageWithMinutes = calculateRankForMetric(filteredData, 'shotsOnTargetPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: goalConversionPercentage

const leagueRankGoalConversionPercentage = calculateRankForMetric(filteredData, 'goalConversionPercentage', p => p.league === selectedPlayer.league);


const leagueRankGoalConversionPercentageWithMinutes = calculateRankForMetric(filteredData, 'goalConversionPercentage', p => p.league === selectedPlayer.league, p => ({...p}));


const samePositionAndLeagueGoalConversionPercentage = calculateRankForMetric(filteredData, 'goalConversionPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueGoalConversionPercentageWithMinutes = calculateRankForMetric(filteredData, 'goalConversionPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: accurateCrossesPercentage

const leagueRankAccurateCrossesPercentage = calculateRankForMetric(filteredData, 'accurateCrossesPercentage', p => p.league === selectedPlayer.league);


const leagueRankAccurateCrossesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateCrossesPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueAccurateCrossesPercentage = calculateRankForMetric(filteredData, 'accurateCrossesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAccurateCrossesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateCrossesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: successfulDribblesPercentage

const leagueRankSuccessfulDribblesPercentage = calculateRankForMetric(filteredData, 'successfulDribblesPercentage', p => p.league === selectedPlayer.league);

const leagueRankSuccessfulDribblesPercentageWithMinutes = calculateRankForMetric(filteredData, 'successfulDribblesPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueSuccessfulDribblesPercentage = calculateRankForMetric(filteredData, 'successfulDribblesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueSuccessfulDribblesPercentageWithMinutes = calculateRankForMetric(filteredData, 'successfulDribblesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: offensiveDuelsWonPercentage

const leagueRankOffensiveDuelsWonPercentage = calculateRankForMetric(filteredData, 'offensiveDuelsWonPercentage', p => p.league === selectedPlayer.league);


const leagueRankOffensiveDuelsWonPercentageWithMinutes = calculateRankForMetric(filteredData, 'offensiveDuelsWonPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueOffensiveDuelsWonPercentage = calculateRankForMetric(filteredData, 'offensiveDuelsWonPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueOffensiveDuelsWonPercentageWithMinutes = calculateRankForMetric(filteredData, 'offensiveDuelsWonPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: accuratePassesPercentage

const leagueRankAccuratePassesPercentage = calculateRankForMetric(filteredData, 'accuratePassesPercentage', p => p.league === selectedPlayer.league);


const leagueRankAccuratePassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accuratePassesPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueAccuratePassesPercentage = calculateRankForMetric(filteredData, 'accuratePassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAccuratePassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accuratePassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: accurateForwardPassesPercentage

const leagueRankAccurateForwardPassesPercentage = calculateRankForMetric(filteredData, 'accurateForwardPassesPercentage', p => p.league === selectedPlayer.league);


const leagueRankAccurateForwardPassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateForwardPassesPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueAccurateForwardPassesPercentage = calculateRankForMetric(filteredData, 'accurateForwardPassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAccurateForwardPassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateForwardPassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: accurateShortMediumPassesPercentage

const leagueRankAccurateShortMediumPassesPercentage = calculateRankForMetric(filteredData, 'accurateShortMediumPassesPercentage', p => p.league === selectedPlayer.league);


const leagueRankAccurateShortMediumPassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateShortMediumPassesPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueAccurateShortMediumPassesPercentage = calculateRankForMetric(filteredData, 'accurateShortMediumPassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAccurateShortMediumPassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateShortMediumPassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: accurateLongPassesPercentage

const leagueRankAccurateLongPassesPercentage = calculateRankForMetric(filteredData, 'accurateLongPassesPercentage', p => p.league === selectedPlayer.league);


const leagueRankAccurateLongPassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateLongPassesPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueAccurateLongPassesPercentage = calculateRankForMetric(filteredData, 'accurateLongPassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAccurateLongPassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateLongPassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: accuratePassesToFinalThirdPercentage

const leagueRankAccuratePassesToFinalThirdPercentage = calculateRankForMetric(filteredData, 'accuratePassesToFinalThirdPercentage', p => p.league === selectedPlayer.league);


const leagueRankAccuratePassesToFinalThirdPercentageWithMinutes = calculateRankForMetric(filteredData, 'accuratePassesToFinalThirdPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueAccuratePassesToFinalThirdPercentage = calculateRankForMetric(filteredData, 'accuratePassesToFinalThirdPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAccuratePassesToFinalThirdPercentageWithMinutes = calculateRankForMetric(filteredData, 'accuratePassesToFinalThirdPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: accuratePassesToPenaltyAreaPercentage

const leagueRankAccuratePassesToPenaltyAreaPercentage = calculateRankForMetric(filteredData, 'accuratePassesToPenaltyAreaPercentage', p => p.league === selectedPlayer.league);


const leagueRankAccuratePassesToPenaltyAreaPercentageWithMinutes = calculateRankForMetric(filteredData, 'accuratePassesToPenaltyAreaPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueAccuratePassesToPenaltyAreaPercentage = calculateRankForMetric(filteredData, 'accuratePassesToPenaltyAreaPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAccuratePassesToPenaltyAreaPercentageWithMinutes = calculateRankForMetric(filteredData, 'accuratePassesToPenaltyAreaPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: accurateThroughPassesPercentage

const leagueRankAccurateThroughPassesPercentage = calculateRankForMetric(filteredData, 'accurateThroughPassesPercentage', p => p.league === selectedPlayer.league);


const leagueRankAccurateThroughPassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateThroughPassesPercentage', p => p.league === selectedPlayer.league, p => ({...p}));

const samePositionAndLeagueAccurateThroughPassesPercentage = calculateRankForMetric(filteredData, 'accurateThroughPassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAccurateThroughPassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateThroughPassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: accurateProgressivePassesPercentage

const leagueRankAccurateProgressivePassesPercentage = calculateRankForMetric(filteredData, 'accurateProgressivePassesPercentage', p => p.league === selectedPlayer.league);


const leagueRankAccurateProgressivePassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateProgressivePassesPercentage', p => p.league === selectedPlayer.league, p => ({...p}));


const samePositionAndLeagueAccurateProgressivePassesPercentage = calculateRankForMetric(filteredData, 'accurateProgressivePassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueAccurateProgressivePassesPercentageWithMinutes = calculateRankForMetric(filteredData, 'accurateProgressivePassesPercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));

// Metric: saveRatePercentage

const leagueRankSaveRatePercentage = calculateRankForMetric(filteredData, 'saveRatePercentage', p => p.league === selectedPlayer.league);


const leagueRankSaveRatePercentageWithMinutes = calculateRankForMetric(filteredData, 'saveRatePercentage', p => p.league === selectedPlayer.league, p => ({...p}));


const samePositionAndLeagueSaveRatePercentage = calculateRankForMetric(filteredData, 'saveRatePercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league);

const samePositionAndLeagueSaveRatePercentageWithMinutes = calculateRankForMetric(filteredData, 'saveRatePercentage', p => p.position === selectedPlayer.position && p.league === selectedPlayer.league, p => ({...p}));
    
    const sectionSelect = document.getElementById('sectionSelect');
    const selectedSection = sectionSelect.options[sectionSelect.selectedIndex].value;
    let titleSuffix = ''; // Initialize the title suffix

// Update the title suffix based on the selected age
if (selectedAge && selectedAge !== '') {
    titleSuffix = ` U${selectedAge}`;
}

    let playerResults = '';

    if (selectedSection === 'samePositionAndLeague') {
    // Define the metrics and their corresponding data
    const metricsData = [
    { name: 'Successful defensive actions', data: samePositionAndLeagueActions },
        { name: 'Defensive duels', data: samePositionAndLeagueDuels },
        { name: 'Aerial duels', data: samePositionAndLeagueAerialDuels },
        { name: 'Tackles', data: samePositionAndLeagueSlidingTackles },
        { name: 'Possession-adjusted tackles', data: samePositionAndLeaguePAdjSlidingTackles },
        { name: 'Blocked shots', data: samePositionAndLeagueShotsBlocked },
        { name: 'Interceptions', data: samePositionAndLeagueInterceptions },
        { name: 'Possession-adjusted interceptions', data: samePositionAndLeaguePAdjInterceptions },
        { name: 'Successful attacking actions', data: samePositionAndLeagueSuccessfulAttackingActions },
        { name: 'Goals', data: samePositionAndLeagueGoals },
        { name: 'Non-penalty goals', data: samePositionAndLeagueNonPenaltyGoals },
        { name: 'Expected goals (xG)', data: samePositionAndLeagueXG },
        { name: 'Headed goals', data: samePositionAndLeagueHeadGoals },
        { name: 'Shots', data: samePositionAndLeagueShots },
        { name: 'Assists', data: samePositionAndLeagueAssists },
        { name: 'Crosses', data: samePositionAndLeagueCrosses },
        { name: 'Crosses to goalkeeper\'s box', data: samePositionAndLeagueCrossesToGoalieBox },
        { name: 'Dribbles', data: samePositionAndLeagueDribbles },
        { name: 'Offensive duels', data: samePositionAndLeagueOffensiveDuels },
        { name: 'Touches in opponent\'s box', data: samePositionAndLeagueTouchesInBox },
        { name: 'Progressive runs', data: samePositionAndLeagueProgressiveRuns },
        { name: 'Accelerations', data: samePositionAndLeagueAccelerations },
        { name: 'Fouls suffered', data: samePositionAndLeagueFoulsSuffered },
        { name: 'Passes', data: samePositionAndLeaguePasses },
        { name: 'Forward passes', data: samePositionAndLeagueForwardPasses },
        { name: 'Short passes', data: samePositionAndLeagueShortMediumPasses },
        { name: 'Long passes', data: samePositionAndLeagueLongPasses },
        { name: 'Average pass length', data: samePositionAndLeagueAveragePassLength },
        { name: 'Expected assists (xA)', data: samePositionAndLeagueXA },
        { name: 'Shot assists', data: samePositionAndLeagueShotAssists },
        { name: 'Key passes', data: samePositionAndLeagueKeyPasses },
        { name: 'Passes to final third', data: samePositionAndLeaguePassesToFinalThird },
        { name: 'Passes to penalty area', data: samePositionAndLeaguePassesToPenaltyArea },
        { name: 'Through passes', data: samePositionAndLeagueThroughPasses },
        { name: 'Deep completions', data: samePositionAndLeagueDeepCompletions },
        { name: 'Progressive passes', data: samePositionAndLeagueProgressivePasses },
        { name: 'Shots against', data: samePositionAndLeagueShotsAgainst },
        { name: 'Clean sheets', data: samePositionAndLeagueCleanSheets },
        { name: 'Expected goals against', data: samePositionAndLeagueXGAgainst },
        { name: 'Prevented goals (PSxG-GA)', data: samePositionAndLeaguePreventedGoals },
        { name: 'Line exits', data: samePositionAndLeagueExits },
        { name: 'Defensive duels won %', data: samePositionAndLeagueDefensiveDuelsWonPercentage },
        { name: 'Aerial duels won %', data: samePositionAndLeagueAerialDuelsWonPercentage },
        { name: 'Shots on target %', data: samePositionAndLeagueShotsOnTargetPercentage },
        { name: 'Goal conversion', data: samePositionAndLeagueGoalConversionPercentage },
        { name: 'Cross accuracy', data: samePositionAndLeagueAccurateCrossesPercentage },
        { name: 'Dribble success rate', data: samePositionAndLeagueSuccessfulDribblesPercentage },
        { name: 'Offensive duels won %', data: samePositionAndLeagueOffensiveDuelsWonPercentage },
        { name: 'Accurate passes %', data: samePositionAndLeagueAccuratePassesPercentage },
        { name: 'Accurate forward passes %', data: samePositionAndLeagueAccurateForwardPassesPercentage },
        { name: 'Accurate short passes %', data: samePositionAndLeagueAccurateShortMediumPassesPercentage },
        { name: 'Accurate long passes %', data: samePositionAndLeagueAccurateLongPassesPercentage },
        { name: 'Accurate passes to final third %', data: samePositionAndLeagueAccuratePassesToFinalThirdPercentage },
        { name: 'Accurate passes to penalty area %', data: samePositionAndLeagueAccuratePassesToPenaltyAreaPercentage },
        { name: 'Through pass accuracy', data: samePositionAndLeagueAccurateThroughPassesPercentage },
        { name: 'Accurate progressive passes %', data: samePositionAndLeagueAccurateProgressivePassesPercentage },
        { name: 'Save percentage', data: samePositionAndLeagueSaveRatePercentage }
                // Add more metrics as needed
    ];

    const positionOrder = {
      'Goalkeeper': [
    'Prevented goals (PSxG-GA)',
    'Save percentage',
    'Clean sheets',
    'Line exits',
    'Shots against',
    'Expected goals against',
    'Accurate passes %',
    'Accurate short passes %',
    'Accurate long passes %',
    'Accurate progressive passes %',
    'Passes',
    'Forward passes',
    'Short passes',
    'Long passes',
    'Progressive passes',
    'Average pass length',
    'Passes to final third',
    'Passes to penalty area',
    'Through passes',
    'Successful defensive actions',
    'Defensive duels',
    'Aerial duels',
    'Tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Fouls suffered',
    'Assists',
    'Dribbles'

],
'Centre-back': [
    'Defensive duels',
    'Defensive duels won %',
    'Successful defensive actions',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots',
    'Progressive runs',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Key passes',
    'Deep completions',
    'Successful attacking actions',
    'Shots',
    'Goals',
    'Headed goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Shot assists',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Touches in opponent\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Accelerations',
    'Fouls suffered'

]
,
'Full-back': [
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Assists',
    'Key passes',
    'Expected assists (xA)',
    'Shot assists',
    'Deep completions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Shots',
    'Shots on target %',
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Headed goals',
    'Goal conversion'




]
,
'Midfielder': [
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Key passes',
    'Expected assists (xA)',
    'Shot assists',
    'Assists',
    'Deep completions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Headed goals',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'

]
,
'Winger': [
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Successful attacking actions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Key passes',
    'Shot assists',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Headed goals',
    'Touches in opponent\'s box',
    'Deep completions',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'

]
,
'Striker': [
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Headed goals',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Key passes',
    'Shot assists',
    'Deep completions',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'



]
        };

        // Reorder the metrics data array based on the selected player's position
        if (selectedPlayer.position in positionOrder) {
            const orderedMetricsData = positionOrder[selectedPlayer.position].map(metricName => metricsData.find(metric => metric.name === metricName));
            metricsData.splice(0, metricsData.length, ...orderedMetricsData);
        }

// Modify your sorting logic to conditionally perform sorting based on the state of the sortEnabled variable
if (sortEnabled) {
  metricsData.sort((a, b) => {
const rankA = a.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;
const rankB = b.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;

    // Handle "N/A" ranks by assigning a default value (e.g., Infinity)
    const defaultRank = Infinity;

    // Convert "N/A" ranks to a default value
    const numericRankA = rankA === "N/A" ? defaultRank : parseInt(rankA);
    const numericRankB = rankB === "N/A" ? defaultRank : parseInt(rankB);

    // Compare ranks
    return numericRankA - numericRankB;
});
}// Construct HTML for metrics
const metricsHTML = metricsData.map(metric => {
    const selectedAge = parseInt(ageSelect.value);
    const filteredData1 = parseCSV(csvData).filter(player => player.position === selectedPlayer.position && player.league === selectedPlayer.league &&
        (!selectedAge || player.age <= selectedAge));
    const playerRank = metric.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;

            // Get the current value for the selected player and metric
            const currentValue = getMetricValueFunction(filteredData1, selectedPlayer, metric.name);

            // Calculate the rank bar width
            const rankBarWidth1 = 100 - (((playerRank - 1) / filteredData1.length) * 100);


    // Interpolate between blue and red based on rank
    const red = Math.round((255 * (1 - Math.pow(rankBarWidth1 / 100, 2))) ); // Red decreases as rank decreases
    const green = Math.round(rankBarWidth1); // Green decreases as rank decreases
    const blue = Math.round((255 * Math.pow(rankBarWidth1 / 100, 2))); // Blue increases as rank increases
    const alpha = 0.835; // Alpha value remains constant

    // Construct the color string
    const color = `rgba(${red}, ${green}, ${blue}, ${alpha})`;

    if (playerRank !== undefined) {
        // Get the rank suffix
        const rankSuffix = getRankSuffix(playerRank);

        // Construct the HTML with the rank and suffix
        return `
        ${metric.name} – ${playerRank}${rankSuffix}
<div class="rank-bar" onclick="toggleActive(this)">
    <div class="rank-bar-fill" style="width: ${rankBarWidth1}%; background-color: ${color}"></div>
        <span class="hover-content">${currentValue}</span>
   
</div>

          `;
    } else {
        // If player rank not found, display a message
        return `${metric.name} – Not available`;
    }
}).join('');



    // Construct player results HTML
    playerResults = `<img class="logo-image" src="https://datamb.football/logopro.png" alt="">
      <h3><b>${selectedPlayer.player} (${selectedPlayer.team}, ${selectedPlayer.age})</b></h3>
      <h1><i>vs ${selectedPlayer.league} ${titleSuffix} ${selectedPlayer.position}s, per 90</i></h1><br>
    <div class="metrics-container">
        ${metricsHTML}
    </div>
         `;
}
else if (selectedSection === 'samePositionAndLeagueWithMinutes') {
    // Define the metrics and their corresponding data
    const metricsData = [
    { name: 'Successful defensive actions', data: samePositionAndLeagueActionsWithMinutes },
        { name: 'Defensive duels', data: samePositionAndLeagueDuelsWithMinutes },
        { name: 'Aerial duels', data: samePositionAndLeagueAerialDuelsWithMinutes },
        { name: 'Tackles', data: samePositionAndLeagueSlidingTacklesWithMinutes },
        { name: 'Possession-adjusted tackles', data: samePositionAndLeaguePAdjSlidingTacklesWithMinutes },
        { name: 'Blocked shots', data: samePositionAndLeagueShotsBlockedWithMinutes },
        { name: 'Interceptions', data: samePositionAndLeagueInterceptionsWithMinutes },
        { name: 'Possession-adjusted interceptions', data: samePositionAndLeaguePAdjInterceptionsWithMinutes },
        { name: 'Successful attacking actions', data: samePositionAndLeagueSuccessfulAttackingActionsWithMinutes },
        { name: 'Goals', data: samePositionAndLeagueGoalsWithMinutes },
        { name: 'Non-penalty goals', data: samePositionAndLeagueNonPenaltyGoalsWithMinutes },
        { name: 'Expected goals (xG)', data: samePositionAndLeagueXGWithMinutes },
        { name: 'Headed goals', data: samePositionAndLeagueHeadGoalsWithMinutes },
        { name: 'Shots', data: samePositionAndLeagueShotsWithMinutes },
        { name: 'Assists', data: samePositionAndLeagueAssistsWithMinutes },
        { name: 'Crosses', data: samePositionAndLeagueCrossesWithMinutes },
        { name: 'Crosses to goalkeeper\'s box', data: samePositionAndLeagueCrossesToGoalieBoxWithMinutes },
        { name: 'Dribbles', data: samePositionAndLeagueDribblesWithMinutes },
        { name: 'Offensive duels', data: samePositionAndLeagueOffensiveDuelsWithMinutes },
        { name: 'Touches in opponent\'s box', data: samePositionAndLeagueTouchesInBoxWithMinutes },
        { name: 'Progressive runs', data: samePositionAndLeagueProgressiveRunsWithMinutes },
        { name: 'Accelerations', data: samePositionAndLeagueAccelerationsWithMinutes },
        { name: 'Fouls suffered', data: samePositionAndLeagueFoulsSufferedWithMinutes },
        { name: 'Passes', data: samePositionAndLeaguePassesWithMinutes },
        { name: 'Forward passes', data: samePositionAndLeagueForwardPassesWithMinutes },
        { name: 'Short passes', data: samePositionAndLeagueShortMediumPassesWithMinutes },
        { name: 'Long passes', data: samePositionAndLeagueLongPassesWithMinutes },
        { name: 'Average pass length', data: samePositionAndLeagueAveragePassLengthWithMinutes },
        { name: 'Expected assists (xA)', data: samePositionAndLeagueXAWithMinutes },
        { name: 'Shot assists', data: samePositionAndLeagueShotAssistsWithMinutes },
        { name: 'Key passes', data: samePositionAndLeagueKeyPassesWithMinutes },
        { name: 'Passes to final third', data: samePositionAndLeaguePassesToFinalThirdWithMinutes },
        { name: 'Passes to penalty area', data: samePositionAndLeaguePassesToPenaltyAreaWithMinutes },
        { name: 'Through passes', data: samePositionAndLeagueThroughPassesWithMinutes },
        { name: 'Deep completions', data: samePositionAndLeagueDeepCompletionsWithMinutes },
        { name: 'Progressive passes', data: samePositionAndLeagueProgressivePassesWithMinutes },
        { name: 'Shots against', data: samePositionAndLeagueShotsAgainstWithMinutes },
        { name: 'Clean sheets', data: samePositionAndLeagueCleanSheetsWithMinutes },
        { name: 'Expected goals against', data: samePositionAndLeagueXGAgainstWithMinutes },
        { name: 'Prevented goals (PSxG-GA)', data: samePositionAndLeaguePreventedGoalsWithMinutes },
        { name: 'Line exits', data: samePositionAndLeagueExitsWithMinutes },
        { name: 'Defensive duels won %', data: samePositionAndLeagueDefensiveDuelsWonPercentageWithMinutes },
        { name: 'Aerial duels won %', data: samePositionAndLeagueAerialDuelsWonPercentageWithMinutes },
        { name: 'Shots on target %', data: samePositionAndLeagueShotsOnTargetPercentageWithMinutes },
        { name: 'Goal conversion', data: samePositionAndLeagueGoalConversionPercentageWithMinutes },
        { name: 'Cross accuracy', data: samePositionAndLeagueAccurateCrossesPercentageWithMinutes },
        { name: 'Dribble success rate', data: samePositionAndLeagueSuccessfulDribblesPercentageWithMinutes },
        { name: 'Offensive duels won %', data: samePositionAndLeagueOffensiveDuelsWonPercentageWithMinutes },
        { name: 'Accurate passes %', data: samePositionAndLeagueAccuratePassesPercentageWithMinutes },
        { name: 'Accurate forward passes %', data: samePositionAndLeagueAccurateForwardPassesPercentageWithMinutes },
        { name: 'Accurate short passes %', data: samePositionAndLeagueAccurateShortMediumPassesPercentageWithMinutes },
        { name: 'Accurate long passes %', data: samePositionAndLeagueAccurateLongPassesPercentageWithMinutes },
        { name: 'Accurate passes to final third %', data: samePositionAndLeagueAccuratePassesToFinalThirdPercentageWithMinutes },
        { name: 'Accurate passes to penalty area %', data: samePositionAndLeagueAccuratePassesToPenaltyAreaPercentageWithMinutes },
        { name: 'Through pass accuracy', data: samePositionAndLeagueAccurateThroughPassesPercentageWithMinutes },
        { name: 'Accurate progressive passes %', data: samePositionAndLeagueAccurateProgressivePassesPercentageWithMinutes },
        { name: 'Save percentage', data: samePositionAndLeagueSaveRatePercentageWithMinutes }
                // Add more metrics as needed
    ];

    const positionOrder = {
      'Goalkeeper': [
    'Prevented goals (PSxG-GA)',
    'Save percentage',
    'Clean sheets',
    'Line exits',
    'Shots against',
    'Expected goals against',
    'Accurate passes %',
    'Accurate short passes %',
    'Accurate long passes %',
    'Accurate progressive passes %',
    'Passes',
    'Forward passes',
    'Short passes',
    'Long passes',
    'Progressive passes',
    'Average pass length',
    'Passes to final third',
    'Passes to penalty area',
    'Through passes',
    'Successful defensive actions',
    'Defensive duels',
    'Aerial duels',
    'Tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Fouls suffered',
    'Assists',
    'Dribbles'

],
'Centre-back': [
    'Defensive duels',
    'Defensive duels won %',
    'Successful defensive actions',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots',
    'Progressive runs',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Key passes',
    'Deep completions',
    'Successful attacking actions',
    'Shots',
    'Goals',
    'Headed goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Shot assists',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Touches in opponent\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Accelerations',
    'Fouls suffered'

]
,
'Full-back': [
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Assists',
    'Key passes',
    'Expected assists (xA)',
    'Shot assists',
    'Deep completions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Shots',
    'Shots on target %',
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Headed goals',
    'Goal conversion'




]
,
'Midfielder': [
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Key passes',
    'Expected assists (xA)',
    'Shot assists',
    'Assists',
    'Deep completions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Headed goals',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'

]
,
'Winger': [
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Successful attacking actions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Key passes',
    'Shot assists',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Headed goals',
    'Touches in opponent\'s box',
    'Deep completions',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'

]
,
'Striker': [
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Headed goals',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Key passes',
    'Shot assists',
    'Deep completions',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'



]
        };

        // Reorder the metrics data array based on the selected player's position
        if (selectedPlayer.position in positionOrder) {
            const orderedMetricsData = positionOrder[selectedPlayer.position].map(metricName => metricsData.find(metric => metric.name === metricName));
            metricsData.splice(0, metricsData.length, ...orderedMetricsData);
        }

// Modify your sorting logic to conditionally perform sorting based on the state of the sortEnabled variable
if (sortEnabled) {
metricsData.sort((a, b) => {
const rankA = a.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;
const rankB = b.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;

    // Handle "N/A" ranks by assigning a default value (e.g., Infinity)
    const defaultRank = Infinity;

    // Convert "N/A" ranks to a default value
    const numericRankA = rankA === "N/A" ? defaultRank : parseInt(rankA);
    const numericRankB = rankB === "N/A" ? defaultRank : parseInt(rankB);

    // Compare ranks
    return numericRankA - numericRankB;
});
}

    // Construct HTML for metrics
// Construct HTML for metrics
const metricsHTML = metricsData.map(metric => {
    const selectedAge = parseInt(ageSelect.value);
        const filteredData2 = parseCSV(csvData).filter(player => player.position === selectedPlayer.position && player.league === selectedPlayer.league &&
    (!selectedAge || player.age <= selectedAge) );
    const playerRank = metric.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;

            // Get the current value for the selected player and metric
            const currentValue2 = getMetricValueFunction(filteredData2, selectedPlayer, metric.name);

            // Calculate the rank bar width
            const rankBarWidth2 = 100 - (((playerRank - 1) / filteredData2.length) * 100);


    // Interpolate between blue and red based on rank
    const red = Math.round((255 * (1 - Math.pow(rankBarWidth2 / 100, 2))) ); // Red decreases as rank decreases
    const green = Math.round(rankBarWidth2); // Green decreases as rank decreases
    const blue = Math.round((255 * Math.pow(rankBarWidth2 / 100, 2))); // Blue increases as rank increases
    const alpha = 0.835; // Alpha value remains constant

    // Construct the color string
    const color = `rgba(${red}, ${green}, ${blue}, ${alpha})`;

    if (playerRank !== undefined) {
        // Get the rank suffix
        const rankSuffix = getRankSuffix(playerRank);

        // Construct the HTML with the rank and suffix
        return `
            ${metric.name} – ${playerRank}${rankSuffix}
            <div class="rank-bar" onclick="toggleActive(this)">
              <div class="rank-bar-fill" style="width: ${rankBarWidth2}%; background-color: ${color}"></div>
                <span class="hover-content">${currentValue2}</span>
                                    
            </div>
          `;
    } else {
        // If player rank not found, display a message
        return `${metric.name} – Not available`;
    }
}).join('');

// Construct player results HTML
    playerResults = `<img class="logo-image" src="https://datamb.football/logopro.png" alt="">
      <h3><b>${selectedPlayer.player} (${selectedPlayer.team}, ${selectedPlayer.age})</b></h3>
      <h1><i>vs ${selectedPlayer.league} ${titleSuffix} ${selectedPlayer.position}s</i></h1><br>
    <div class="metrics-container">
        ${metricsHTML}
    </div>
          `;
} else if (selectedSection === 'league') {
    // Define the metrics and their corresponding data
    const metricsData = [
    { name: 'Successful defensive actions', data: leagueRankActions },
        { name: 'Defensive duels', data: leagueRankDuels },
        { name: 'Aerial duels', data: leagueRankAerialDuels },
        { name: 'Tackles', data: leagueRankSlidingTackles },
        { name: 'Possession-adjusted tackles', data: leagueRankPAdjSlidingTackles },
        { name: 'Blocked shots', data: leagueRankShotsBlocked },
        { name: 'Interceptions', data: leagueRankInterceptions },
        { name: 'Possession-adjusted interceptions', data: leagueRankPAdjInterceptions },
        { name: 'Successful attacking actions', data: leagueRankSuccessfulAttackingActions },
        { name: 'Goals', data: leagueRankGoals },
        { name: 'Non-penalty goals', data: leagueRankNonPenaltyGoals },
        { name: 'Expected goals (xG)', data: leagueRankXG },
        { name: 'Headed goals', data: leagueRankHeadGoals },
        { name: 'Shots', data: leagueRankShots },
        { name: 'Assists', data: leagueRankAssists },
        { name: 'Crosses', data: leagueRankCrosses },
        { name: 'Crosses to goalkeeper\'s box', data: leagueRankCrossesToGoalieBox },
        { name: 'Dribbles', data: leagueRankDribbles },
        { name: 'Offensive duels', data: leagueRankOffensiveDuels },
        { name: 'Touches in opponent\'s box', data: leagueRankTouchesInBox },
        { name: 'Progressive runs', data: leagueRankProgressiveRuns },
        { name: 'Accelerations', data: leagueRankAccelerations },
        { name: 'Fouls suffered', data: leagueRankFoulsSuffered },
        { name: 'Passes', data: leagueRankPasses },
        { name: 'Forward passes', data: leagueRankForwardPasses },
        { name: 'Short passes', data: leagueRankShortMediumPasses },
        { name: 'Long passes', data: leagueRankLongPasses },
        { name: 'Average pass length', data: leagueRankAveragePassLength },
        { name: 'Expected assists (xA)', data: leagueRankXA },
        { name: 'Shot assists', data: leagueRankShotAssists },
        { name: 'Key passes', data: leagueRankKeyPasses },
        { name: 'Passes to final third', data: leagueRankPassesToFinalThird },
        { name: 'Passes to penalty area', data: leagueRankPassesToPenaltyArea },
        { name: 'Through passes', data: leagueRankThroughPasses },
        { name: 'Deep completions', data: leagueRankDeepCompletions },
        { name: 'Progressive passes', data: leagueRankProgressivePasses },
        { name: 'Shots against', data: leagueRankShotsAgainst },
        { name: 'Clean sheets', data: leagueRankCleanSheets },
        { name: 'Expected goals against', data: leagueRankXGAgainst },
        { name: 'Prevented goals (PSxG-GA)', data: leagueRankPreventedGoals },
        { name: 'Line exits', data: leagueRankExits },
        { name: 'Defensive duels won %', data: leagueRankDefensiveDuelsWonPercentage },
        { name: 'Aerial duels won %', data: leagueRankAerialDuelsWonPercentage },
        { name: 'Shots on target %', data: leagueRankShotsOnTargetPercentage },
        { name: 'Goal conversion', data: leagueRankGoalConversionPercentage },
        { name: 'Cross accuracy', data: leagueRankAccurateCrossesPercentage },
        { name: 'Dribble success rate', data: leagueRankSuccessfulDribblesPercentage },
        { name: 'Offensive duels won %', data: leagueRankOffensiveDuelsWonPercentage },
        { name: 'Accurate passes %', data: leagueRankAccuratePassesPercentage },
        { name: 'Accurate forward passes %', data: leagueRankAccurateForwardPassesPercentage },
        { name: 'Accurate short passes %', data: leagueRankAccurateShortMediumPassesPercentage },
        { name: 'Accurate long passes %', data: leagueRankAccurateLongPassesPercentage },
        { name: 'Accurate passes to final third %', data: leagueRankAccuratePassesToFinalThirdPercentage },
        { name: 'Accurate passes to penalty area %', data: leagueRankAccuratePassesToPenaltyAreaPercentage },
        { name: 'Through pass accuracy', data: leagueRankAccurateThroughPassesPercentage },
        { name: 'Accurate progressive passes %', data: leagueRankAccurateProgressivePassesPercentage },
        { name: 'Save percentage', data: leagueRankSaveRatePercentage }
                // Add more metrics as needed
    ];

    const positionOrder = {
      'Goalkeeper': [
    'Prevented goals (PSxG-GA)',
    'Save percentage',
    'Clean sheets',
    'Line exits',
    'Shots against',
    'Expected goals against',
    'Accurate passes %',
    'Accurate short passes %',
    'Accurate long passes %',
    'Accurate progressive passes %',
    'Passes',
    'Forward passes',
    'Short passes',
    'Long passes',
    'Progressive passes',
    'Average pass length',
    'Passes to final third',
    'Passes to penalty area',
    'Through passes',
    'Successful defensive actions',
    'Defensive duels',
    'Aerial duels',
    'Tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Fouls suffered',
    'Assists',
    'Dribbles'

],
'Centre-back': [
    'Defensive duels',
    'Defensive duels won %',
    'Successful defensive actions',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots',
    'Progressive runs',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Key passes',
    'Deep completions',
    'Successful attacking actions',
    'Shots',
    'Goals',
    'Headed goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Shot assists',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Touches in opponent\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Accelerations',
    'Fouls suffered'

]
,
'Full-back': [
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Assists',
    'Key passes',
    'Expected assists (xA)',
    'Shot assists',
    'Deep completions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Shots',
    'Shots on target %',
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Headed goals',
    'Goal conversion'




]
,
'Midfielder': [
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Key passes',
    'Expected assists (xA)',
    'Shot assists',
    'Assists',
    'Deep completions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Headed goals',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'

]
,
'Winger': [
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Successful attacking actions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Key passes',
    'Shot assists',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Headed goals',
    'Touches in opponent\'s box',
    'Deep completions',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'

]
,
'Striker': [
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Headed goals',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Key passes',
    'Shot assists',
    'Deep completions',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'



]
        };

        // Reorder the metrics data array based on the selected player's position
        if (selectedPlayer.position in positionOrder) {
            const orderedMetricsData = positionOrder[selectedPlayer.position].map(metricName => metricsData.find(metric => metric.name === metricName));
            metricsData.splice(0, metricsData.length, ...orderedMetricsData);
        }

// Modify your sorting logic to conditionally perform sorting based on the state of the sortEnabled variable
if (sortEnabled) {
metricsData.sort((a, b) => {
const rankA = a.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;
const rankB = b.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;

    // Handle "N/A" ranks by assigning a default value (e.g., Infinity)
    const defaultRank = Infinity;

    // Convert "N/A" ranks to a default value
    const numericRankA = rankA === "N/A" ? defaultRank : parseInt(rankA);
    const numericRankB = rankB === "N/A" ? defaultRank : parseInt(rankB);

    // Compare ranks
    return numericRankA - numericRankB;
});
}

    // Construct HTML for metrics
 // Construct HTML for metrics
 const metricsHTML = metricsData.map(metric => {
    const selectedAge = parseInt(ageSelect.value);
        const filteredData5 = parseCSV(csvData).filter(player => player.league === selectedPlayer.league &&
    (!selectedAge || player.age <= selectedAge) );
    const playerRank = metric.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;

            // Get the current value for the selected player and metric
            const currentValue5 = getMetricValueFunction(filteredData5, selectedPlayer, metric.name);

            // Calculate the rank bar width
            const rankBarWidth5 = 100 - (((playerRank - 1) / filteredData5.length) * 100);


    // Interpolate between blue and red based on rank
    const red = Math.round((255 * (1 - Math.pow(rankBarWidth5 / 100, 2))) ); // Red decreases as rank decreases
    const green = Math.round(rankBarWidth5); // Green decreases as rank decreases
    const blue = Math.round((255 * Math.pow(rankBarWidth5 / 100, 2))); // Blue increases as rank increases
    const alpha = 0.835; // Alpha value remains constant

    // Construct the color string
    const color = `rgba(${red}, ${green}, ${blue}, ${alpha})`;

    if (playerRank !== undefined) {
        // Get the rank suffix
        const rankSuffix = getRankSuffix(playerRank);

        // Construct the HTML with the rank and suffix
        return `
            ${metric.name} – ${playerRank}${rankSuffix}
            <div class="rank-bar" onclick="toggleActive(this)">
              <div class="rank-bar-fill" style="width: ${rankBarWidth5}%; background-color: ${color}"></div>
                <span class="hover-content">${currentValue5}</span>
                                    
            </div>
          `;
    } else {
        // If player rank not found, display a message
        return `${metric.name} – Not available`;
    }
}).join('');

// Construct player results HTML
    playerResults = `<img class="logo-image" src="https://datamb.football/logopro.png" alt="">
      <h3><b>${selectedPlayer.player} (${selectedPlayer.team}, ${selectedPlayer.age})</b></h3>
      <h1><i>vs ${selectedPlayer.league} ${titleSuffix} players, per 90</i></h1><br>      
    <div class="metrics-container">
        ${metricsHTML}
    </div>
          `;
} else if (selectedSection === 'leagueWithMinutes') {
    // Define the metrics and their corresponding data
    const metricsData = [
    { name: 'Successful defensive actions', data: leagueRankActionsWithMinutes },
        { name: 'Defensive duels', data: leagueRankDuelsWithMinutes },
        { name: 'Aerial duels', data: leagueRankAerialDuelsWithMinutes },
        { name: 'Tackles', data: leagueRankSlidingTacklesWithMinutes },
        { name: 'Possession-adjusted tackles', data: leagueRankPAdjSlidingTacklesWithMinutes },
        { name: 'Blocked shots', data: leagueRankShotsBlockedWithMinutes },
        { name: 'Interceptions', data: leagueRankInterceptionsWithMinutes },
        { name: 'Possession-adjusted interceptions', data: leagueRankPAdjInterceptionsWithMinutes },
        { name: 'Successful attacking actions', data: leagueRankSuccessfulAttackingActionsWithMinutes },
        { name: 'Goals', data: leagueRankGoalsWithMinutes },
        { name: 'Non-penalty goals', data: leagueRankNonPenaltyGoalsWithMinutes },
        { name: 'Expected goals (xG)', data: leagueRankXGWithMinutes },
        { name: 'Headed goals', data: leagueRankHeadGoalsWithMinutes },
        { name: 'Shots', data: leagueRankShotsWithMinutes },
        { name: 'Assists', data: leagueRankAssistsWithMinutes },
        { name: 'Crosses', data: leagueRankCrossesWithMinutes },
        { name: 'Crosses to goalkeeper\'s box', data: leagueRankCrossesToGoalieBoxWithMinutes },
        { name: 'Dribbles', data: leagueRankDribblesWithMinutes },
        { name: 'Offensive duels', data: leagueRankOffensiveDuelsWithMinutes },
        { name: 'Touches in opponent\'s box', data: leagueRankTouchesInBoxWithMinutes },
        { name: 'Progressive runs', data: leagueRankProgressiveRunsWithMinutes },
        { name: 'Accelerations', data: leagueRankAccelerationsWithMinutes },
        { name: 'Fouls suffered', data: leagueRankFoulsSufferedWithMinutes },
        { name: 'Passes', data: leagueRankPassesWithMinutes },
        { name: 'Forward passes', data: leagueRankForwardPassesWithMinutes },
        { name: 'Short passes', data: leagueRankShortMediumPassesWithMinutes },
        { name: 'Long passes', data: leagueRankLongPassesWithMinutes },
        { name: 'Average pass length', data: leagueRankAveragePassLengthWithMinutes },
        { name: 'Expected assists (xA)', data: leagueRankXAWithMinutes },
        { name: 'Shot assists', data: leagueRankShotAssistsWithMinutes },
        { name: 'Key passes', data: leagueRankKeyPassesWithMinutes },
        { name: 'Passes to final third', data: leagueRankPassesToFinalThirdWithMinutes },
        { name: 'Passes to penalty area', data: leagueRankPassesToPenaltyAreaWithMinutes },
        { name: 'Through passes', data: leagueRankThroughPassesWithMinutes },
        { name: 'Deep completions', data: leagueRankDeepCompletionsWithMinutes },
        { name: 'Progressive passes', data: leagueRankProgressivePassesWithMinutes },
        { name: 'Shots against', data: leagueRankShotsAgainstWithMinutes },
        { name: 'Clean sheets', data: leagueRankCleanSheetsWithMinutes },
        { name: 'Expected goals against', data: leagueRankXGAgainstWithMinutes },
        { name: 'Prevented goals (PSxG-GA)', data: leagueRankPreventedGoalsWithMinutes },
        { name: 'Line exits', data: leagueRankExitsWithMinutes },
        { name: 'Defensive duels won %', data: leagueRankDefensiveDuelsWonPercentageWithMinutes },
        { name: 'Aerial duels won %', data: leagueRankAerialDuelsWonPercentageWithMinutes },
        { name: 'Shots on target %', data: leagueRankShotsOnTargetPercentageWithMinutes },
        { name: 'Goal conversion', data: leagueRankGoalConversionPercentageWithMinutes },
        { name: 'Cross accuracy', data: leagueRankAccurateCrossesPercentageWithMinutes },
        { name: 'Dribble success rate', data: leagueRankSuccessfulDribblesPercentageWithMinutes },
        { name: 'Offensive duels won %', data: leagueRankOffensiveDuelsWonPercentageWithMinutes },
        { name: 'Accurate passes %', data: leagueRankAccuratePassesPercentageWithMinutes },
        { name: 'Accurate forward passes %', data: leagueRankAccurateForwardPassesPercentageWithMinutes },
        { name: 'Accurate short passes %', data: leagueRankAccurateShortMediumPassesPercentageWithMinutes },
        { name: 'Accurate long passes %', data: leagueRankAccurateLongPassesPercentageWithMinutes },
        { name: 'Accurate passes to final third %', data: leagueRankAccuratePassesToFinalThirdPercentageWithMinutes },
        { name: 'Accurate passes to penalty area %', data: leagueRankAccuratePassesToPenaltyAreaPercentageWithMinutes },
        { name: 'Through pass accuracy', data: leagueRankAccurateThroughPassesPercentageWithMinutes },
        { name: 'Accurate progressive passes %', data: leagueRankAccurateProgressivePassesPercentageWithMinutes },
        { name: 'Save percentage', data: leagueRankSaveRatePercentageWithMinutes }

                // Add more metrics as needed
    ];

    const positionOrder = {
      'Goalkeeper': [
    'Prevented goals (PSxG-GA)',
    'Save percentage',
    'Clean sheets',
    'Line exits',
    'Shots against',
    'Expected goals against',
    'Accurate passes %',
    'Accurate short passes %',
    'Accurate long passes %',
    'Accurate progressive passes %',
    'Passes',
    'Forward passes',
    'Short passes',
    'Long passes',
    'Progressive passes',
    'Average pass length',
    'Passes to final third',
    'Passes to penalty area',
    'Through passes',
    'Successful defensive actions',
    'Defensive duels',
    'Aerial duels',
    'Tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Fouls suffered',
    'Assists',
    'Dribbles'

],
'Centre-back': [
    'Defensive duels',
    'Defensive duels won %',
    'Successful defensive actions',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots',
    'Progressive runs',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Key passes',
    'Deep completions',
    'Successful attacking actions',
    'Shots',
    'Goals',
    'Headed goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Shot assists',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Touches in opponent\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Accelerations',
    'Fouls suffered'

]
,
'Full-back': [
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Assists',
    'Key passes',
    'Expected assists (xA)',
    'Shot assists',
    'Deep completions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Shots',
    'Shots on target %',
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Headed goals',
    'Goal conversion'




]
,
'Midfielder': [
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Key passes',
    'Expected assists (xA)',
    'Shot assists',
    'Assists',
    'Deep completions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Headed goals',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'

]
,
'Winger': [
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Successful attacking actions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Key passes',
    'Shot assists',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Headed goals',
    'Touches in opponent\'s box',
    'Deep completions',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'

]
,
'Striker': [
    'Goals',
    'Non-penalty goals',
    'Expected goals (xG)',
    'Assists',
    'Expected assists (xA)',
    'Headed goals',
    'Shots',
    'Shots on target %',
    'Goal conversion',
    'Touches in opponent\'s box',
    'Successful attacking actions',
    'Crosses',
    'Cross accuracy',
    'Crosses to goalkeeper\'s box',
    'Dribbles',
    'Dribble success rate',
    'Offensive duels',
    'Offensive duels won %',
    'Progressive runs',
    'Accelerations',
    'Fouls suffered',
    'Key passes',
    'Shot assists',
    'Deep completions',
    'Passes',
    'Accurate passes %',
    'Forward passes',
    'Accurate forward passes %',
    'Short passes',
    'Accurate short passes %',
    'Long passes',
    'Accurate long passes %',
    'Progressive passes',
    'Accurate progressive passes %',
    'Passes to final third',
    'Accurate passes to final third %',
    'Passes to penalty area',
    'Accurate passes to penalty area %',
    'Through passes',
    'Average pass length',
    'Successful defensive actions',
    'Defensive duels',
    'Defensive duels won %',
    'Aerial duels',
    'Aerial duels won %',
    'Tackles',
    'Possession-adjusted tackles',
    'Interceptions',
    'Possession-adjusted interceptions',
    'Blocked shots'



]
        };

        // Reorder the metrics data array based on the selected player's position
        if (selectedPlayer.position in positionOrder) {
            const orderedMetricsData = positionOrder[selectedPlayer.position].map(metricName => metricsData.find(metric => metric.name === metricName));
            metricsData.splice(0, metricsData.length, ...orderedMetricsData);
        }

// Modify your sorting logic to conditionally perform sorting based on the state of the sortEnabled variable
if (sortEnabled) {
metricsData.sort((a, b) => {
const rankA = a.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;
const rankB = b.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;

    // Handle "N/A" ranks by assigning a default value (e.g., Infinity)
    const defaultRank = Infinity;

    // Convert "N/A" ranks to a default value
    const numericRankA = rankA === "N/A" ? defaultRank : parseInt(rankA);
    const numericRankB = rankB === "N/A" ? defaultRank : parseInt(rankB);

    // Compare ranks
    return numericRankA - numericRankB;
});
}

    // Construct HTML for metrics
    // Construct HTML for metrics
    const metricsHTML = metricsData.map(metric => {
    const selectedAge = parseInt(ageSelect.value);
        const filteredData6 = parseCSV(csvData).filter(player => player.league === selectedPlayer.league &&
    (!selectedAge || player.age <= selectedAge) );
    const playerRank = metric.data.find(rank => rank.player === selectedPlayer.player && rank.team === selectedPlayer.team).rank;

            // Get the current value for the selected player and metric
            const currentValue6 = getMetricValueFunction(filteredData6, selectedPlayer, metric.name);

            // Calculate the rank bar width
            const rankBarWidth6 = 100 - (((playerRank - 1) / filteredData6.length) * 100);


    // Interpolate between blue and red based on rank
    const red = Math.round((255 * (1 - Math.pow(rankBarWidth6 / 100, 2))) ); // Red decreases as rank decreases
    const green = Math.round(rankBarWidth6); // Green decreases as rank decreases
    const blue = Math.round((255 * Math.pow(rankBarWidth6 / 100, 2))); // Blue increases as rank increases
    const alpha = 0.835; // Alpha value remains constant

    // Construct the color string
    const color = `rgba(${red}, ${green}, ${blue}, ${alpha})`;

    if (playerRank !== undefined) {
        // Get the rank suffix
        const rankSuffix = getRankSuffix(playerRank);

        // Construct the HTML with the rank and suffix
        return `
            ${metric.name} – ${playerRank}${rankSuffix}
            <div class="rank-bar" onclick="toggleActive(this)">
              <div class="rank-bar-fill" style="width: ${rankBarWidth6}%; background-color: ${color}"></div>
                <span class="hover-content">${currentValue6}</span>
                                    
            </div>
          `;
    } else {
        // If player rank not found, display a message
        return `${metric.name} – Not available`;
    }
}).join('');


// Construct player results HTML
    playerResults = `<img class="logo-image" src="https://datamb.football/logopro.png" alt="">
      <h3><b>${selectedPlayer.player} (${selectedPlayer.team}, ${selectedPlayer.age})</b></h3>
    <h1><i>vs ${selectedPlayer.league} ${titleSuffix} players</i></h1><br>
    <div class="metrics-container">
        ${metricsHTML}
    </div>
          `;
} 

    // Add more sections as needed

    document.getElementById('results').innerHTML = playerResults;
  }



const parsedData = parseCSV(csvData);

populatePlayerOptions();

  function populatePlayerOptions() {
    const playerSelect = document.getElementById('playerSelect');
    const spinner = document.querySelector('.spinner');
    filterPlayerOptions();

    function removeSpecialChars(str) {
        return str.normalize('NFD').replace(/[\u0300-\u036f]/g,'') 
        .replace(/Ø/g, 'O')
        .replace(/ø/g, 'o');
      }

    // Function to filter player options based on search text
    function filterPlayerOptions(searchText = '') {
        // Clear existing options
        playerSelect.innerHTML = '';

        const emptyOption = document.createElement('option');
        emptyOption.value = ''; // Set an empty value
        emptyOption.textContent = ''; // Provide a placeholder text
        playerSelect.appendChild(emptyOption);

        // Filter players based on search text
        const filteredPlayers = parsedData.filter(player => {
            const playerName = player.player.toLowerCase();
            const playerNameWithoutSpecialChars = removeSpecialChars(playerName);
            return playerName.includes(searchText.toLowerCase()) ||
                playerNameWithoutSpecialChars.includes(searchText.toLowerCase());
        });

        // Append filtered player options
        filteredPlayers.forEach(player => {
            const option = document.createElement('option');
            option.value = player.player;
            option.textContent = `${player.player}, ${player.position}, ${player.team}`;
            playerSelect.appendChild(option);
        });

        // Sort the options alphabetically
        const optionsArray = Array.from(playerSelect.options);
        optionsArray.sort((a, b) => a.textContent.localeCompare(b.textContent));
        optionsArray.forEach(option => playerSelect.appendChild(option));

        // Ensure nothing is pre-selected
        playerSelect.selectedIndex = -1;
    }

    
    // Call filterPlayerOptions initially without any searchText

    // Bind event listeners to update player options
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', function () {
        const searchText = this.value.trim();
        filterPlayerOptions(searchText);
    });

    // Handle keyup event to update player options (for Safari)
    searchInput.addEventListener('keyup', function () {
        const searchText = this.value.trim();
        filterPlayerOptions(searchText);
    });

    // Hide spinner
    spinner.style.display = 'none';
}


      const searchInput = document.getElementById('searchInput');
      const customDropdown = document.querySelector('.custom-dropdown');
      const playerSelect = document.getElementById('playerSelect');
      const spinner = document.querySelector('.spinner');




// Bind event listener to the search input
searchInput.addEventListener('input', function () {
  // Show spinner

  // Get the search text and remove special characters
  const searchText = removeSpecialChars(this.value.trim());

  // Simulate long computation with setTimeout
  setTimeout(() => {
    // Loop through options and display only those that match the search text
    for (let i = 0; i < playerSelect.options.length; i++) {
      const optionText = playerSelect.options[i].textContent;
      if (removeSpecialChars(optionText.toLowerCase()).includes(searchText.toLowerCase()) || i === 0) {
        playerSelect.options[i].style.display = '';
      } else {
        playerSelect.options[i].style.display = 'none';
      }
    }

    // Show or hide the custom dropdown based on input value
    if (searchText === '') {
      customDropdown.classList.remove('open');
    } else {
      customDropdown.classList.add('open');
    }

    // Hide spinner
    hideSpinner();
  }, 1); // Adjust the timeout value as needed
});

      // Bind event listener to the select element for selection
      playerSelect.addEventListener('change', function () {
        // Show spinner
        showSpinner();

        const selectedIndex = this.selectedIndex;
        searchInput.value = '';
        const selectedPlayerName = this.options[selectedIndex].value;
        const selectedPlayerPosition = this.options[selectedIndex].textContent.split(', ')[1];
        const selectedPlayerTeam = this.options[selectedIndex].textContent.split(', ')[2];
        const selectedPlayer = {
          player: selectedPlayerName,
          team: selectedPlayerTeam,
          position: selectedPlayerPosition
        };

        // Simulate long computation with setTimeout
        setTimeout(() => {
          displaySelectedPlayer(selectedPlayer);

          // Hide spinner
          hideSpinner();
        }, 1000); // Adjust the timeout value as needed
      });

      // Bind event listener to sectionSelect for selection
      document.getElementById('sectionSelect').addEventListener('change', function () {
        // Show spinner
        showSpinner();

        // Simulate long computation with setTimeout
        setTimeout(() => {
            displaySelectedPlayer();
          // Hide spinner
          hideSpinner();
        }, 1000); // Adjust the timeout value as needed
      });

      // Bind event listener to ageSelect for selection
      document.getElementById('ageSelect').addEventListener('change', function () {
        // Show spinner
        showSpinner();

        // Simulate long computation with setTimeout
        setTimeout(() => {
            displaySelectedPlayer();

          // Hide spinner
          hideSpinner();
        }, 1000); // Adjust the timeout value as needed
      });
  

    // Your existing code for populating options and other event listeners
    
    // Bind event listener to toggleMetrics for selection
    document.getElementById('toggleMetrics').addEventListener('change', function () {
        // Show spinner
        showSpinner();

        // Simulate long computation with setTimeout
        setTimeout(() => {
            displaySelectedPlayer();
            // Hide spinner
            hideSpinner();
        }, 1000); // Adjust the timeout value as needed
    });


document.getElementById('toggleSortingButton').addEventListener('change', function () {
    // Show spinner
    showSpinner();

    // Toggle the sorting preference
    sortEnabled = !sortEnabled;



    // Simulate long computation with setTimeout
    setTimeout(() => {
        // Display selected player again to reflect the change
        displaySelectedPlayer();

        // Hide spinner
        hideSpinner();
    }, 1000); // Adjust the timeout value as needed
});


});function toggleActive(element) {
  element.classList.toggle('active');
}



</script>



</body>
</html>
